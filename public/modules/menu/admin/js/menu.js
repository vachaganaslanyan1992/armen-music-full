/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./Modules/Menu/node_modules/nestable2/jquery.nestable.js":
/*!****************************************************************!*\
  !*** ./Modules/Menu/node_modules/nestable2/jquery.nestable.js ***!
  \****************************************************************/
/***/ (() => {

eval("/*!\n * Nestable jQuery Plugin - Copyright (c) 2014 Ramon Smit - https://github.com/RamonSmit/Nestable\n */\n\n(function($, window, document, undefined) {\n    var hasTouch = 'ontouchstart' in document;\n\n    /**\n     * Detect CSS pointer-events property\n     * events are normally disabled on the dragging element to avoid conflicts\n     * https://github.com/ausi/Feature-detection-technique-for-pointer-events/blob/master/modernizr-pointerevents.js\n     */\n    var hasPointerEvents = (function() {\n        var el = document.createElement('div'),\n            docEl = document.documentElement;\n        if (!('pointerEvents' in el.style)) {\n            return false;\n        }\n        el.style.pointerEvents = 'auto';\n        el.style.pointerEvents = 'x';\n        docEl.appendChild(el);\n        var supports = window.getComputedStyle && window.getComputedStyle(el, '').pointerEvents === 'auto';\n        docEl.removeChild(el);\n        return !!supports;\n    })();\n\n    var defaults = {\n        contentCallback: function(item) {return item.content || '' ? item.content : item.id;},\n        listNodeName: 'ol',\n        itemNodeName: 'li',\n        handleNodeName: 'div',\n        contentNodeName: 'span',\n        rootClass: 'dd',\n        listClass: 'dd-list',\n        itemClass: 'dd-item',\n        dragClass: 'dd-dragel',\n        handleClass: 'dd-handle',\n        contentClass: 'dd-content',\n        collapsedClass: 'dd-collapsed',\n        placeClass: 'dd-placeholder',\n        noDragClass: 'dd-nodrag',\n        noChildrenClass: 'dd-nochildren',\n        emptyClass: 'dd-empty',\n        expandBtnHTML: '<button class=\"dd-expand\" data-action=\"expand\" type=\"button\">Expand</button>',\n        collapseBtnHTML: '<button class=\"dd-collapse\" data-action=\"collapse\" type=\"button\">Collapse</button>',\n        group: 0,\n        maxDepth: 5,\n        threshold: 20,\n        fixedDepth: false, //fixed item's depth\n        fixed: false,\n        includeContent: false,\n        scroll: false,\n        scrollSensitivity: 1,\n        scrollSpeed: 5,\n        scrollTriggers: {\n            top: 40,\n            left: 40,\n            right: -40,\n            bottom: -40\n        },\n        effect: {\n            animation: 'none',\n            time: 'slow'\n        },\n        callback: function(l, e, p) {},\n        onDragStart: function(l, e, p) {},\n        beforeDragStop: function(l, e, p) {},\n        listRenderer: function(children, options) {\n            var html = '<' + options.listNodeName + ' class=\"' + options.listClass + '\">';\n            html += children;\n            html += '</' + options.listNodeName + '>';\n\n            return html;\n        },\n        itemRenderer: function(item_attrs, content, children, options, item) {\n            var item_attrs_string = $.map(item_attrs, function(value, key) {\n                return ' ' + key + '=\"' + value + '\"';\n            }).join(' ');\n\n            var html = '<' + options.itemNodeName + item_attrs_string + '>';\n            html += '<' + options.handleNodeName + ' class=\"' + options.handleClass + '\">';\n            html += '<' + options.contentNodeName + ' class=\"' + options.contentClass + '\">';\n            html += content;\n            html += '</' + options.contentNodeName + '>';\n            html += '</' + options.handleNodeName + '>';\n            html += children;\n            html += '</' + options.itemNodeName + '>';\n\n            return html;\n        }\n    };\n\n    function Plugin(element, options) {\n        this.w  = $(document);\n        this.el = $(element);\n        options = options || defaults;\n\n        if (options.rootClass !== undefined && options.rootClass !== 'dd') {\n            options.listClass       = options.listClass ? options.listClass : options.rootClass + '-list';\n            options.itemClass       = options.itemClass ? options.itemClass : options.rootClass + '-item';\n            options.dragClass       = options.dragClass ? options.dragClass : options.rootClass + '-dragel';\n            options.handleClass     = options.handleClass ? options.handleClass : options.rootClass + '-handle';\n            options.collapsedClass  = options.collapsedClass ? options.collapsedClass : options.rootClass + '-collapsed';\n            options.placeClass      = options.placeClass ? options.placeClass : options.rootClass + '-placeholder';\n            options.noDragClass     = options.noDragClass ? options.noDragClass : options.rootClass + '-nodrag';\n            options.noChildrenClass = options.noChildrenClass ? options.noChildrenClass : options.rootClass + '-nochildren';\n            options.emptyClass      = options.emptyClass ? options.emptyClass : options.rootClass + '-empty';\n        }\n\n        this.options = $.extend({}, defaults, options);\n\n        // build HTML from serialized JSON if passed\n        if (this.options.json !== undefined) {\n            this._build();\n        }\n\n        this.init();\n    }\n\n    Plugin.prototype = {\n\n        init: function() {\n            var list = this;\n\n            list.reset();\n            list.el.data('nestable-group', this.options.group);\n            list.placeEl = $('<div class=\"' + list.options.placeClass + '\"/>');\n\n            var items = this.el.find(list.options.itemNodeName);\n            $.each(items, function(k, el) {\n                var item = $(el),\n                    parent = item.parent();\n                list.setParent(item);\n                if (parent.hasClass(list.options.collapsedClass)) {\n                    list.collapseItem(parent.parent());\n                }\n            });\n\n            // Append the .dd-empty div if the list don't have any items on init\n            if (!items.length) {\n                this.appendEmptyElement(this.el);\n            }\n\n            list.el.on('click', 'button', function(e) {\n                if (list.dragEl) {\n                    return;\n                }\n                var target = $(e.currentTarget),\n                    action = target.data('action'),\n                    item = target.parents(list.options.itemNodeName).eq(0);\n                if (action === 'collapse') {\n                    list.collapseItem(item);\n                }\n                if (action === 'expand') {\n                    list.expandItem(item);\n                }\n            });\n\n            var onStartEvent = function(e) {\n                var handle = $(e.target);\n                if (!handle.hasClass(list.options.handleClass)) {\n                    if (handle.closest('.' + list.options.noDragClass).length) {\n                        return;\n                    }\n                    handle = handle.closest('.' + list.options.handleClass);\n                }\n                if (!handle.length || list.dragEl) {\n                    return;\n                }\n\n                list.isTouch = /^touch/.test(e.type);\n                if (list.isTouch && e.touches.length !== 1) {\n                    return;\n                }\n\n                e.preventDefault();\n                list.dragStart(e.touches ? e.touches[0] : e);\n            };\n\n            var onMoveEvent = function(e) {\n                if (list.dragEl) {\n                    e.preventDefault();\n                    list.dragMove(e.touches ? e.touches[0] : e);\n                }\n            };\n\n            var onEndEvent = function(e) {\n                if (list.dragEl) {\n                    e.preventDefault();\n                    list.dragStop(e.touches ? e.changedTouches[0] : e);\n                }\n            };\n\n            if (hasTouch) {\n                list.el[0].addEventListener('touchstart', onStartEvent, false);\n                window.addEventListener('touchmove', onMoveEvent, false);\n                window.addEventListener('touchend', onEndEvent, false);\n                window.addEventListener('touchcancel', onEndEvent, false);\n            }\n\n            list.el.on('mousedown', onStartEvent);\n            list.w.on('mousemove', onMoveEvent);\n            list.w.on('mouseup', onEndEvent);\n\n            var destroyNestable = function()\n            {\n                if (hasTouch) {\n                    list.el[0].removeEventListener('touchstart', onStartEvent, false);\n                    window.removeEventListener('touchmove', onMoveEvent, false);\n                    window.removeEventListener('touchend', onEndEvent, false);\n                    window.removeEventListener('touchcancel', onEndEvent, false);\n                }\n\n                list.el.off('mousedown', onStartEvent);\n                list.w.off('mousemove', onMoveEvent);\n                list.w.off('mouseup', onEndEvent);\n\n                list.el.off('click');\n                list.el.unbind('destroy-nestable');\n\n                list.el.data(\"nestable\", null);\n            };\n\n            list.el.bind('destroy-nestable', destroyNestable);\n\n        },\n\n        destroy: function ()\n        {\n            this.el.trigger('destroy-nestable');\n        },\n\n        add: function (item)\n        {\n            var listClassSelector = '.' + this.options.listClass;\n            var tree = $(this.el).children(listClassSelector);\n\n            if (item.parent_id !== undefined) {\n                tree = tree.find('[data-id=\"' + item.parent_id + '\"]');\n                delete item.parent_id;\n\n                if (tree.children(listClassSelector).length === 0) {\n                    tree = tree.append(this.options.listRenderer('', this.options));\n                }\n\n                tree = tree.find(listClassSelector + ':first');\n                this.setParent(tree.parent());\n            }\n\n            tree.append(this._buildItem(item, this.options));\n        },\n\n        replace: function (item)\n        {\n            var html = this._buildItem(item, this.options);\n\n            this._getItemById(item.id)\n                .replaceWith(html);\n        },\n\n        //removes item and additional elements from list\n        removeItem: function (item){\n            var opts = this.options,\n                el   = this.el;\n\n            // remove item\n            item = item || this;\n            item.remove();\n\n            // remove empty children lists\n            var emptyListsSelector = '.' + opts.listClass\n                + ' .' + opts.listClass + ':not(:has(*))';\n            $(el).find(emptyListsSelector).remove();\n\n            // remove buttons if parents do not have children\n            var buttonsSelector = '[data-action=\"expand\"], [data-action=\"collapse\"]';\n            $(el).find(buttonsSelector).each(function() {\n                var siblings = $(this).siblings('.' + opts.listClass);\n                if (siblings.length === 0) {\n                    $(this).remove();\n                }\n            });\n        },\n\n        //removes item by itemId and run callback at the end\n        remove: function (itemId, callback)\n        {\n            var opts = this.options;\n            var list = this;\n            var item = this._getItemById(itemId);\n\n            //animation style\n            var animation = opts.effect.animation || 'fade';\n\n            //animation time\n            var time = opts.effect.time || 'slow';\n\n            //add fadeOut effect when removing\n            if (animation === 'fade'){\n                item.fadeOut(time, function(){\n                    list.removeItem(item);\n                });\n            }\n            else {\n                this.removeItem(item);\n            }\n\n            if (callback) callback();\n        },\n\n        //removes all items from the list and run callback at the end\n        removeAll: function(callback){\n\n            var list  = this,\n                opts  = this.options,\n                node  = list.el.find(opts.listNodeName).first(),\n                items = node.children(opts.itemNodeName);\n\n            //animation style\n            var animation = opts.effect.animation || 'fade';\n\n            //animation time\n            var time = opts.effect.time || 'slow';\n\n            function remove(){\n                //Removes each item and its children.\n                items.each(function() {\n                    list.removeItem($(this));\n                });\n                //Now we can again show our node element\n                node.show();\n                if (callback) callback();\n            }\n\n            //add fadeOut effect when removing\n            if (animation === 'fade'){\n                node.fadeOut(time, remove);\n            }\n            else {\n                remove();\n            }\n        },\n\n        _getItemById: function(itemId) {\n            return $(this.el).children('.' + this.options.listClass)\n                .find('[data-id=\"' + itemId + '\"]');\n        },\n\n        _build: function() {\n            var json = this.options.json;\n\n            if (typeof json === 'string') {\n                json = JSON.parse(json);\n            }\n\n            $(this.el).html(this._buildList(json, this.options));\n        },\n\n        _buildList: function(items, options) {\n            if (!items) {\n                return '';\n            }\n\n            var children = '';\n            var that = this;\n\n            $.each(items, function(index, sub) {\n                children += that._buildItem(sub, options);\n            });\n\n            return options.listRenderer(children, options);\n        },\n\n        _buildItem: function(item, options) {\n            function escapeHtml(text) {\n                var map = {\n                    '&': '&amp;',\n                    '<': '&lt;',\n                    '>': '&gt;',\n                    '\"': '&quot;',\n                    \"'\": '&#039;'\n                };\n\n                return text + \"\".replace(/[&<>\"']/g, function(m) { return map[m]; });\n            }\n\n            function filterClasses(classes) {\n                var new_classes = {};\n\n                for (var k in classes) {\n                    // Remove duplicates\n                    new_classes[classes[k]] = classes[k];\n                }\n\n                return new_classes;\n            }\n\n            function createClassesString(item, options) {\n                var classes = item.classes || {};\n\n                if (typeof classes === 'string') {\n                    classes = [classes];\n                }\n\n                var item_classes = filterClasses(classes);\n                item_classes[options.itemClass] = options.itemClass;\n\n                // create class string\n                return $.map(item_classes, function(val) {\n                    return val;\n                }).join(' ');\n            }\n\n            function createDataAttrs(attr) {\n                attr = $.extend({}, attr);\n\n                delete attr.children;\n                delete attr.classes;\n                delete attr.content;\n\n                var data_attrs = {};\n\n                $.each(attr, function(key, value) {\n                    if (typeof value === 'object') {\n                        value = JSON.stringify(value);\n                    }\n\n                    data_attrs[\"data-\" + key] = escapeHtml(value);\n                });\n\n                return data_attrs;\n            }\n\n            var item_attrs = createDataAttrs(item);\n            item_attrs[\"class\"] = createClassesString(item, options);\n\n            var content = options.contentCallback(item);\n            var children = this._buildList(item.children, options);\n            var html = $(options.itemRenderer(item_attrs, content, children, options, item));\n\n            this.setParent(html);\n\n            return html[0].outerHTML;\n        },\n\n        serialize: function() {\n            var data, list = this, step = function(level) {\n                var array = [],\n                    items = level.children(list.options.itemNodeName);\n                items.each(function() {\n                    var li = $(this),\n                        item = $.extend({}, li.data()),\n                        sub = li.children(list.options.listNodeName);\n\n                    if (list.options.includeContent) {\n                        var content = li.find('.' + list.options.contentClass).html();\n\n                        if (content) {\n                            item.content = content;\n                        }\n                    }\n\n                    if (sub.length) {\n                        item.children = step(sub);\n                    }\n                    array.push(item);\n                });\n                return array;\n            };\n            data = step(list.el.find(list.options.listNodeName).first());\n            return data;\n        },\n\n        asNestedSet: function() {\n            var list = this, o = list.options, depth = -1, ret = [], lft = 1;\n            var items = list.el.find(o.listNodeName).first().children(o.itemNodeName);\n\n            items.each(function () {\n                lft = traverse(this, depth + 1, lft);\n            });\n\n            ret = ret.sort(function(a,b){ return (a.lft - b.lft); });\n            return ret;\n\n            function traverse(item, depth, lft) {\n                var rgt = lft + 1, id, pid;\n\n                if ($(item).children(o.listNodeName).children(o.itemNodeName).length > 0 ) {\n                    depth++;\n                    $(item).children(o.listNodeName).children(o.itemNodeName).each(function () {\n                        rgt = traverse($(this), depth, rgt);\n                    });\n                    depth--;\n                }\n\n                id = $(item).attr('data-id');\n                if (isInt(id)) {\n                    id = parseInt(id);\n                }\n\n                pid = $(item).parent(o.listNodeName).parent(o.itemNodeName).attr('data-id') || '';\n                if (isInt(pid)) {\n                    id = parseInt(pid);\n                }\n\n                if (id) {\n                    ret.push({\"id\": id, \"parent_id\": pid, \"depth\": depth, \"lft\": lft, \"rgt\": rgt});\n                }\n\n                lft = rgt + 1;\n                return lft;\n            }\n\n            function isInt(value) {\n                return $.isNumeric(value) && Math.floor(value) == value;\n            }\n        },\n\n        returnOptions: function() {\n            return this.options;\n        },\n\n        serialise: function() {\n            return this.serialize();\n        },\n\n        toHierarchy: function(options) {\n\n            var o = $.extend({}, this.options, options),\n                ret = [];\n\n            $(this.element).children(o.items).each(function() {\n                var level = _recursiveItems(this);\n                ret.push(level);\n            });\n\n            return ret;\n\n            function _recursiveItems(item) {\n                var id = ($(item).attr(o.attribute || 'id') || '').match(o.expression || (/(.+)[-=_](.+)/));\n                if (id) {\n                    var currentItem = {\n                        \"id\": id[2]\n                    };\n                    if ($(item).children(o.listType).children(o.items).length > 0) {\n                        currentItem.children = [];\n                        $(item).children(o.listType).children(o.items).each(function() {\n                            var level = _recursiveItems(this);\n                            currentItem.children.push(level);\n                        });\n                    }\n                    return currentItem;\n                }\n            }\n        },\n\n        toArray: function() {\n\n            var o = $.extend({}, this.options, this),\n                sDepth = o.startDepthCount || 0,\n                ret = [],\n                left = 2,\n                list = this,\n                element = list.el.find(list.options.listNodeName).first();\n\n            var items = element.children(list.options.itemNodeName);\n            items.each(function() {\n                left = _recursiveArray($(this), sDepth + 1, left);\n            });\n\n            ret = ret.sort(function(a, b) {\n                return (a.left - b.left);\n            });\n\n            return ret;\n\n            function _recursiveArray(item, depth, left) {\n\n                var right = left + 1,\n                    id,\n                    pid;\n\n                if (item.children(o.options.listNodeName).children(o.options.itemNodeName).length > 0) {\n                    depth++;\n                    item.children(o.options.listNodeName).children(o.options.itemNodeName).each(function() {\n                        right = _recursiveArray($(this), depth, right);\n                    });\n                    depth--;\n                }\n\n                id = item.data().id;\n\n\n                if (depth === sDepth + 1) {\n                    pid = o.rootID;\n                } else {\n\n                    var parentItem = (item.parent(o.options.listNodeName)\n                        .parent(o.options.itemNodeName)\n                        .data());\n                    pid = parentItem.id;\n\n                }\n\n                if (id) {\n                    ret.push({\n                        \"id\": id,\n                        \"parent_id\": pid,\n                        \"depth\": depth,\n                        \"left\": left,\n                        \"right\": right\n                    });\n                }\n\n                left = right + 1;\n                return left;\n            }\n\n        },\n\n        reset: function() {\n            this.mouse = {\n                offsetX: 0,\n                offsetY: 0,\n                startX: 0,\n                startY: 0,\n                lastX: 0,\n                lastY: 0,\n                nowX: 0,\n                nowY: 0,\n                distX: 0,\n                distY: 0,\n                dirAx: 0,\n                dirX: 0,\n                dirY: 0,\n                lastDirX: 0,\n                lastDirY: 0,\n                distAxX: 0,\n                distAxY: 0\n            };\n            this.isTouch = false;\n            this.moving = false;\n            this.dragEl = null;\n            this.dragRootEl = null;\n            this.dragDepth = 0;\n            this.hasNewRoot = false;\n            this.pointEl = null;\n        },\n\n        expandItem: function(li) {\n            li.removeClass(this.options.collapsedClass);\n        },\n\n        collapseItem: function(li) {\n            var lists = li.children(this.options.listNodeName);\n            if (lists.length) {\n                li.addClass(this.options.collapsedClass);\n            }\n        },\n\n        expandAll: function() {\n            var list = this;\n            list.el.find(list.options.itemNodeName).each(function() {\n                list.expandItem($(this));\n            });\n        },\n\n        collapseAll: function() {\n            var list = this;\n            list.el.find(list.options.itemNodeName).each(function() {\n                list.collapseItem($(this));\n            });\n        },\n\n        setParent: function(li) {\n            //Check if li is an element of itemNodeName type and has children\n            if (li.is(this.options.itemNodeName) && li.children(this.options.listNodeName).length) {\n                // make sure NOT showing two or more sets data-action buttons\n                li.children('[data-action]').remove();\n                li.prepend($(this.options.expandBtnHTML));\n                li.prepend($(this.options.collapseBtnHTML));\n            }\n        },\n\n        unsetParent: function(li) {\n            li.removeClass(this.options.collapsedClass);\n            li.children('[data-action]').remove();\n            li.children(this.options.listNodeName).remove();\n        },\n\n        dragStart: function(e) {\n            var mouse = this.mouse,\n                target = $(e.target),\n                dragItem = target.closest(this.options.itemNodeName),\n                position = {\n                    top  : e.pageY,\n                    left : e.pageX\n                };\n\n            var continueExecution = this.options.onDragStart.call(this, this.el, dragItem, position);\n\n            if (typeof continueExecution !== 'undefined' && continueExecution === false) {\n                return;\n            }\n\n            this.placeEl.css('height', dragItem.height());\n\n            mouse.offsetX = e.pageX - dragItem.offset().left;\n            mouse.offsetY = e.pageY - dragItem.offset().top;\n            mouse.startX = mouse.lastX = e.pageX;\n            mouse.startY = mouse.lastY = e.pageY;\n\n            this.dragRootEl = this.el;\n            this.dragEl = $(document.createElement(this.options.listNodeName)).addClass(this.options.listClass + ' ' + this.options.dragClass);\n            this.dragEl.css('width', dragItem.outerWidth());\n\n            this.setIndexOfItem(dragItem);\n\n            // fix for zepto.js\n            //dragItem.after(this.placeEl).detach().appendTo(this.dragEl);\n            dragItem.after(this.placeEl);\n            dragItem[0].parentNode.removeChild(dragItem[0]);\n            dragItem.appendTo(this.dragEl);\n\n            $(document.body).append(this.dragEl);\n            this.dragEl.css({\n                'left': e.pageX - mouse.offsetX,\n                'top': e.pageY - mouse.offsetY\n            });\n            // total depth of dragging item\n            var i, depth,\n                items = this.dragEl.find(this.options.itemNodeName);\n            for (i = 0; i < items.length; i++) {\n                depth = $(items[i]).parents(this.options.listNodeName).length;\n                if (depth > this.dragDepth) {\n                    this.dragDepth = depth;\n                }\n            }\n        },\n\n        //Create sublevel.\n        //  element : element which become parent\n        //  item    : something to place into new sublevel\n        createSubLevel: function(element, item) {\n            var list = $('<' + this.options.listNodeName + '/>').addClass(this.options.listClass);\n            if (item) list.append(item);\n            element.append(list);\n            this.setParent(element);\n            return list;\n        },\n\n        setIndexOfItem: function(item, index) {\n            index = index || [];\n\n            index.unshift(item.index());\n\n            if ($(item[0].parentNode)[0] !== this.dragRootEl[0]) {\n                this.setIndexOfItem($(item[0].parentNode), index);\n            }\n            else {\n                this.dragEl.data('indexOfItem', index);\n            }\n        },\n\n        restoreItemAtIndex: function(dragElement, indexArray) {\n            var currentEl = this.el,\n                lastIndex = indexArray.length - 1;\n\n            //Put drag element at current element position.\n            function placeElement(currentEl, dragElement) {\n                if (indexArray[lastIndex] === 0) {\n                    $(currentEl).prepend(dragElement.clone(true)); //using true saves added to element events.\n                }\n                else {\n                    $(currentEl.children[indexArray[lastIndex] - 1]).after(dragElement.clone(true)); //using true saves added to element events.\n                }\n            }\n            //Diggin through indexArray to get home for dragElement.\n            for (var i = 0; i < indexArray.length; i++) {\n                if (lastIndex === parseInt(i)) {\n                    placeElement(currentEl, dragElement);\n                    return;\n                }\n                //element can have no indexes, so we have to use conditional here to avoid errors.\n                //if element doesn't exist we defenetly need to add new list.\n                var element = (currentEl[0]) ? currentEl[0] : currentEl;\n                var nextEl  = element.children[indexArray[i]];\n                currentEl   = (!nextEl) ? this.createSubLevel($(element)) : nextEl;\n            }\n        },\n\n        dragStop: function(e) {\n            // fix for zepto.js\n            //this.placeEl.replaceWith(this.dragEl.children(this.options.itemNodeName + ':first').detach());\n            var position = {\n                top  : e.pageY,\n                left : e.pageX\n            };\n            //Get indexArray of item at drag start.\n            var srcIndex = this.dragEl.data('indexOfItem');\n\n            var el = this.dragEl.children(this.options.itemNodeName).first();\n\n            el[0].parentNode.removeChild(el[0]);\n\n            this.dragEl.remove(); //Remove dragEl, cause it can affect on indexing in html collection.\n\n            //Before drag stop callback\n            var continueExecution = this.options.beforeDragStop.call(this, this.el, el, this.placeEl.parent());\n            if (typeof continueExecution !== 'undefined' && continueExecution === false) {\n                var parent = this.placeEl.parent();\n                this.placeEl.remove();\n                if (!parent.children().length) {\n                    this.unsetParent(parent.parent());\n                }\n                this.restoreItemAtIndex(el, srcIndex);\n                this.reset();\n                return;\n            }\n\n            this.placeEl.replaceWith(el);\n\n            if (this.hasNewRoot) {\n                if (this.options.fixed === true) {\n                    this.restoreItemAtIndex(el, srcIndex);\n                }\n                else {\n                    this.el.trigger('lostItem');\n                }\n                this.dragRootEl.trigger('gainedItem');\n            }\n            else {\n                this.dragRootEl.trigger('change');\n            }\n\n            this.options.callback.call(this, this.dragRootEl, el, position);\n\n            this.reset();\n        },\n\n        dragMove: function(e) {\n            var list, parent, prev, next, depth,\n                opt = this.options,\n                mouse = this.mouse;\n\n            this.dragEl.css({\n                'left': e.pageX - mouse.offsetX,\n                'top': e.pageY - mouse.offsetY\n            });\n\n            // mouse position last events\n            mouse.lastX = mouse.nowX;\n            mouse.lastY = mouse.nowY;\n            // mouse position this events\n            mouse.nowX = e.pageX;\n            mouse.nowY = e.pageY;\n            // distance mouse moved between events\n            mouse.distX = mouse.nowX - mouse.lastX;\n            mouse.distY = mouse.nowY - mouse.lastY;\n            // direction mouse was moving\n            mouse.lastDirX = mouse.dirX;\n            mouse.lastDirY = mouse.dirY;\n            // direction mouse is now moving (on both axis)\n            mouse.dirX = mouse.distX === 0 ? 0 : mouse.distX > 0 ? 1 : -1;\n            mouse.dirY = mouse.distY === 0 ? 0 : mouse.distY > 0 ? 1 : -1;\n            // axis mouse is now moving on\n            var newAx = Math.abs(mouse.distX) > Math.abs(mouse.distY) ? 1 : 0;\n\n            // do nothing on first move\n            if (!mouse.moving) {\n                mouse.dirAx = newAx;\n                mouse.moving = true;\n                return;\n            }\n\n            // do scrolling if enable\n            if (opt.scroll) {\n                if (typeof window.jQuery.fn.scrollParent !== 'undefined') {\n                    var scrolled = false;\n                    var scrollParent = this.el.scrollParent()[0];\n                    if (scrollParent !== document && scrollParent.tagName !== 'HTML') {\n                        if ((opt.scrollTriggers.bottom + scrollParent.offsetHeight) - e.pageY < opt.scrollSensitivity)\n                            scrollParent.scrollTop = scrolled = scrollParent.scrollTop + opt.scrollSpeed;\n                        else if (e.pageY - opt.scrollTriggers.top < opt.scrollSensitivity)\n                            scrollParent.scrollTop = scrolled = scrollParent.scrollTop - opt.scrollSpeed;\n\n                        if ((opt.scrollTriggers.right + scrollParent.offsetWidth) - e.pageX < opt.scrollSensitivity)\n                            scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft + opt.scrollSpeed;\n                        else if (e.pageX - opt.scrollTriggers.left < opt.scrollSensitivity)\n                            scrollParent.scrollLeft = scrolled = scrollParent.scrollLeft - opt.scrollSpeed;\n                    } else {\n                        if (e.pageY - $(document).scrollTop() < opt.scrollSensitivity)\n                            scrolled = $(document).scrollTop($(document).scrollTop() - opt.scrollSpeed);\n                        else if ($(window).height() - (e.pageY - $(document).scrollTop()) < opt.scrollSensitivity)\n                            scrolled = $(document).scrollTop($(document).scrollTop() + opt.scrollSpeed);\n\n                        if (e.pageX - $(document).scrollLeft() < opt.scrollSensitivity)\n                            scrolled = $(document).scrollLeft($(document).scrollLeft() - opt.scrollSpeed);\n                        else if ($(window).width() - (e.pageX - $(document).scrollLeft()) < opt.scrollSensitivity)\n                            scrolled = $(document).scrollLeft($(document).scrollLeft() + opt.scrollSpeed);\n                    }\n                } else {\n                    console.warn('To use scrolling you need to have scrollParent() function, check documentation for more information');\n                }\n            }\n\n            if (this.scrollTimer) {\n                clearTimeout(this.scrollTimer);\n            }\n\n            if (opt.scroll && scrolled) {\n                this.scrollTimer = setTimeout(function() {\n                    $(window).trigger(e);\n                }, 10);\n            }\n\n            // calc distance moved on this axis (and direction)\n            if (mouse.dirAx !== newAx) {\n                mouse.distAxX = 0;\n                mouse.distAxY = 0;\n            }\n            else {\n                mouse.distAxX += Math.abs(mouse.distX);\n                if (mouse.dirX !== 0 && mouse.dirX !== mouse.lastDirX) {\n                    mouse.distAxX = 0;\n                }\n                mouse.distAxY += Math.abs(mouse.distY);\n                if (mouse.dirY !== 0 && mouse.dirY !== mouse.lastDirY) {\n                    mouse.distAxY = 0;\n                }\n            }\n            mouse.dirAx = newAx;\n\n            /**\n             * move horizontal\n             */\n            if (mouse.dirAx && mouse.distAxX >= opt.threshold) {\n                // reset move distance on x-axis for new phase\n                mouse.distAxX = 0;\n                prev = this.placeEl.prev(opt.itemNodeName);\n                // increase horizontal level if previous sibling exists, is not collapsed, and can have children\n                if (mouse.distX > 0 && prev.length && !prev.hasClass(opt.collapsedClass) && !prev.hasClass(opt.noChildrenClass)) {\n                    // cannot increase level when item above is collapsed\n                    list = prev.find(opt.listNodeName).last();\n                    // check if depth limit has reached\n                    depth = this.placeEl.parents(opt.listNodeName).length;\n                    if (depth + this.dragDepth <= opt.maxDepth) {\n                        // create new sub-level if one doesn't exist\n                        if (!list.length) {\n                            this.createSubLevel(prev, this.placeEl);\n                        }\n                        else {\n                            // else append to next level up\n                            list = prev.children(opt.listNodeName).last();\n                            list.append(this.placeEl);\n                        }\n                    }\n                }\n                // decrease horizontal level\n                if (mouse.distX < 0) {\n                    // we can't decrease a level if an item preceeds the current one\n                    next = this.placeEl.next(opt.itemNodeName);\n                    if (!next.length) {\n                        parent = this.placeEl.parent();\n                        this.placeEl.closest(opt.itemNodeName).after(this.placeEl);\n                        if (!parent.children().length) {\n                            this.unsetParent(parent.parent());\n                        }\n                    }\n                }\n            }\n\n            var isEmpty = false;\n\n            // find list item under cursor\n            if (!hasPointerEvents) {\n                this.dragEl[0].style.visibility = 'hidden';\n            }\n            this.pointEl = $(document.elementFromPoint(e.pageX - document.body.scrollLeft, e.pageY - (window.pageYOffset || document.documentElement.scrollTop)));\n            if (!hasPointerEvents) {\n                this.dragEl[0].style.visibility = 'visible';\n            }\n            if (this.pointEl.hasClass(opt.handleClass)) {\n                this.pointEl = this.pointEl.closest(opt.itemNodeName);\n            }\n            if (this.pointEl.hasClass(opt.emptyClass)) {\n                isEmpty = true;\n            }\n            else if (!this.pointEl.length || !this.pointEl.hasClass(opt.itemClass)) {\n                return;\n            }\n\n            // find parent list of item under cursor\n            var pointElRoot = this.pointEl.closest('.' + opt.rootClass),\n                isNewRoot = this.dragRootEl.data('nestable-id') !== pointElRoot.data('nestable-id');\n\n            /**\n             * move vertical\n             */\n            if (!mouse.dirAx || isNewRoot || isEmpty) {\n                // check if groups match if dragging over new root\n                if (isNewRoot && opt.group !== pointElRoot.data('nestable-group')) {\n                    return;\n                }\n\n                // fixed item's depth, use for some list has specific type, eg:'Volume, Section, Chapter ...'\n                if (this.options.fixedDepth && this.dragDepth + 1 !== this.pointEl.parents(opt.listNodeName).length) {\n                    return;\n                }\n\n                // check depth limit\n                depth = this.dragDepth - 1 + this.pointEl.parents(opt.listNodeName).length;\n                if (depth > opt.maxDepth) {\n                    return;\n                }\n                var before = e.pageY < (this.pointEl.offset().top + this.pointEl.height() / 2);\n                parent = this.placeEl.parent();\n                // if empty create new list to replace empty placeholder\n                if (isEmpty) {\n                    list = $(document.createElement(opt.listNodeName)).addClass(opt.listClass);\n                    list.append(this.placeEl);\n                    this.pointEl.replaceWith(list);\n                }\n                else if (before) {\n                    this.pointEl.before(this.placeEl);\n                }\n                else {\n                    this.pointEl.after(this.placeEl);\n                }\n                if (!parent.children().length) {\n                    this.unsetParent(parent.parent());\n                }\n                if (!this.dragRootEl.find(opt.itemNodeName).length) {\n                    this.appendEmptyElement(this.dragRootEl);\n                }\n                // parent root list has changed\n                this.dragRootEl = pointElRoot;\n                if (isNewRoot) {\n                    this.hasNewRoot = this.el[0] !== this.dragRootEl[0];\n                }\n            }\n        },\n\n        // Append the .dd-empty div to the list so it can be populated and styled\n        appendEmptyElement: function(element) {\n            element.append('<div class=\"' + this.options.emptyClass + '\"/>');\n        }\n    };\n\n    $.fn.nestable = function(params) {\n        var lists  = this,\n            retval = this,\n            args   = arguments;\n\n        if (!('Nestable' in window)) {\n            window.Nestable = {};\n            Nestable.counter = 0;\n        }\n\n        lists.each(function() {\n            var plugin = $(this).data(\"nestable\");\n\n            if (!plugin) {\n                Nestable.counter++;\n                $(this).data(\"nestable\", new Plugin(this, params));\n                $(this).data(\"nestable-id\", Nestable.counter);\n            }\n            else {\n                if (typeof params === 'string' && typeof plugin[params] === 'function') {\n                    if (args.length > 1){\n                        var pluginArgs = [];\n                        for (var i = 1; i < args.length; i++) {\n                            pluginArgs.push(args[i]);\n                        }\n                        retval = plugin[params].apply(plugin, pluginArgs);\n                    }\n                    else {\n                        retval = plugin[params]();\n                    }\n                }\n            }\n        });\n\n        return retval || lists;\n    };\n\n})(window.jQuery || window.Zepto, window, document);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9Nb2R1bGVzL01lbnUvbm9kZV9tb2R1bGVzL25lc3RhYmxlMi9qcXVlcnkubmVzdGFibGUuanMuanMiLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7O0FBRUw7QUFDQSx5Q0FBeUMsb0RBQW9EO0FBQzdGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxzQ0FBc0M7QUFDdEMseUNBQXlDO0FBQ3pDLDRDQUE0QztBQUM1QztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsa0NBQWtDOztBQUVsQztBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTs7QUFFYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0IsOEJBQThCO0FBQzlCLDhCQUE4QjtBQUM5QixnQ0FBZ0M7QUFDaEMsZ0NBQWdDO0FBQ2hDOztBQUVBLG1FQUFtRSxnQkFBZ0I7QUFDbkY7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCOztBQUVBO0FBQ0Esa0NBQWtDOztBQUVsQztBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQkFBaUI7O0FBRWpCO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBDQUEwQztBQUMxQzs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGFBQWE7O0FBRWIsMENBQTBDLHlCQUF5QjtBQUNuRTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw4QkFBOEIsbUVBQW1FO0FBQ2pHOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQSxTQUFTOztBQUVUOztBQUVBLCtCQUErQjtBQUMvQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUI7QUFDekI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUOztBQUVBLCtCQUErQjtBQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7O0FBRWI7QUFDQTtBQUNBLGFBQWE7O0FBRWI7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7O0FBRUE7OztBQUdBO0FBQ0E7QUFDQSxrQkFBa0I7O0FBRWxCO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0Isa0JBQWtCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7O0FBRVQ7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtRUFBbUU7QUFDbkU7QUFDQTtBQUNBLHFHQUFxRztBQUNyRztBQUNBO0FBQ0E7QUFDQSw0QkFBNEIsdUJBQXVCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUEsa0NBQWtDOztBQUVsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxhQUFhOztBQUViO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCO0FBQ3RCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUzs7QUFFVDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLGlCQUFpQjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTOztBQUVUO0FBQ0E7O0FBRUEsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL2ZsZWV0Y2FydC8uL01vZHVsZXMvTWVudS9ub2RlX21vZHVsZXMvbmVzdGFibGUyL2pxdWVyeS5uZXN0YWJsZS5qcz9mY2ZhIl0sInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogTmVzdGFibGUgalF1ZXJ5IFBsdWdpbiAtIENvcHlyaWdodCAoYykgMjAxNCBSYW1vbiBTbWl0IC0gaHR0cHM6Ly9naXRodWIuY29tL1JhbW9uU21pdC9OZXN0YWJsZVxuICovXG5cbihmdW5jdGlvbigkLCB3aW5kb3csIGRvY3VtZW50LCB1bmRlZmluZWQpIHtcbiAgICB2YXIgaGFzVG91Y2ggPSAnb250b3VjaHN0YXJ0JyBpbiBkb2N1bWVudDtcblxuICAgIC8qKlxuICAgICAqIERldGVjdCBDU1MgcG9pbnRlci1ldmVudHMgcHJvcGVydHlcbiAgICAgKiBldmVudHMgYXJlIG5vcm1hbGx5IGRpc2FibGVkIG9uIHRoZSBkcmFnZ2luZyBlbGVtZW50IHRvIGF2b2lkIGNvbmZsaWN0c1xuICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hdXNpL0ZlYXR1cmUtZGV0ZWN0aW9uLXRlY2huaXF1ZS1mb3ItcG9pbnRlci1ldmVudHMvYmxvYi9tYXN0ZXIvbW9kZXJuaXpyLXBvaW50ZXJldmVudHMuanNcbiAgICAgKi9cbiAgICB2YXIgaGFzUG9pbnRlckV2ZW50cyA9IChmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksXG4gICAgICAgICAgICBkb2NFbCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudDtcbiAgICAgICAgaWYgKCEoJ3BvaW50ZXJFdmVudHMnIGluIGVsLnN0eWxlKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnYXV0byc7XG4gICAgICAgIGVsLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAneCc7XG4gICAgICAgIGRvY0VsLmFwcGVuZENoaWxkKGVsKTtcbiAgICAgICAgdmFyIHN1cHBvcnRzID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUgJiYgd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWwsICcnKS5wb2ludGVyRXZlbnRzID09PSAnYXV0byc7XG4gICAgICAgIGRvY0VsLnJlbW92ZUNoaWxkKGVsKTtcbiAgICAgICAgcmV0dXJuICEhc3VwcG9ydHM7XG4gICAgfSkoKTtcblxuICAgIHZhciBkZWZhdWx0cyA9IHtcbiAgICAgICAgY29udGVudENhbGxiYWNrOiBmdW5jdGlvbihpdGVtKSB7cmV0dXJuIGl0ZW0uY29udGVudCB8fCAnJyA/IGl0ZW0uY29udGVudCA6IGl0ZW0uaWQ7fSxcbiAgICAgICAgbGlzdE5vZGVOYW1lOiAnb2wnLFxuICAgICAgICBpdGVtTm9kZU5hbWU6ICdsaScsXG4gICAgICAgIGhhbmRsZU5vZGVOYW1lOiAnZGl2JyxcbiAgICAgICAgY29udGVudE5vZGVOYW1lOiAnc3BhbicsXG4gICAgICAgIHJvb3RDbGFzczogJ2RkJyxcbiAgICAgICAgbGlzdENsYXNzOiAnZGQtbGlzdCcsXG4gICAgICAgIGl0ZW1DbGFzczogJ2RkLWl0ZW0nLFxuICAgICAgICBkcmFnQ2xhc3M6ICdkZC1kcmFnZWwnLFxuICAgICAgICBoYW5kbGVDbGFzczogJ2RkLWhhbmRsZScsXG4gICAgICAgIGNvbnRlbnRDbGFzczogJ2RkLWNvbnRlbnQnLFxuICAgICAgICBjb2xsYXBzZWRDbGFzczogJ2RkLWNvbGxhcHNlZCcsXG4gICAgICAgIHBsYWNlQ2xhc3M6ICdkZC1wbGFjZWhvbGRlcicsXG4gICAgICAgIG5vRHJhZ0NsYXNzOiAnZGQtbm9kcmFnJyxcbiAgICAgICAgbm9DaGlsZHJlbkNsYXNzOiAnZGQtbm9jaGlsZHJlbicsXG4gICAgICAgIGVtcHR5Q2xhc3M6ICdkZC1lbXB0eScsXG4gICAgICAgIGV4cGFuZEJ0bkhUTUw6ICc8YnV0dG9uIGNsYXNzPVwiZGQtZXhwYW5kXCIgZGF0YS1hY3Rpb249XCJleHBhbmRcIiB0eXBlPVwiYnV0dG9uXCI+RXhwYW5kPC9idXR0b24+JyxcbiAgICAgICAgY29sbGFwc2VCdG5IVE1MOiAnPGJ1dHRvbiBjbGFzcz1cImRkLWNvbGxhcHNlXCIgZGF0YS1hY3Rpb249XCJjb2xsYXBzZVwiIHR5cGU9XCJidXR0b25cIj5Db2xsYXBzZTwvYnV0dG9uPicsXG4gICAgICAgIGdyb3VwOiAwLFxuICAgICAgICBtYXhEZXB0aDogNSxcbiAgICAgICAgdGhyZXNob2xkOiAyMCxcbiAgICAgICAgZml4ZWREZXB0aDogZmFsc2UsIC8vZml4ZWQgaXRlbSdzIGRlcHRoXG4gICAgICAgIGZpeGVkOiBmYWxzZSxcbiAgICAgICAgaW5jbHVkZUNvbnRlbnQ6IGZhbHNlLFxuICAgICAgICBzY3JvbGw6IGZhbHNlLFxuICAgICAgICBzY3JvbGxTZW5zaXRpdml0eTogMSxcbiAgICAgICAgc2Nyb2xsU3BlZWQ6IDUsXG4gICAgICAgIHNjcm9sbFRyaWdnZXJzOiB7XG4gICAgICAgICAgICB0b3A6IDQwLFxuICAgICAgICAgICAgbGVmdDogNDAsXG4gICAgICAgICAgICByaWdodDogLTQwLFxuICAgICAgICAgICAgYm90dG9tOiAtNDBcbiAgICAgICAgfSxcbiAgICAgICAgZWZmZWN0OiB7XG4gICAgICAgICAgICBhbmltYXRpb246ICdub25lJyxcbiAgICAgICAgICAgIHRpbWU6ICdzbG93J1xuICAgICAgICB9LFxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24obCwgZSwgcCkge30sXG4gICAgICAgIG9uRHJhZ1N0YXJ0OiBmdW5jdGlvbihsLCBlLCBwKSB7fSxcbiAgICAgICAgYmVmb3JlRHJhZ1N0b3A6IGZ1bmN0aW9uKGwsIGUsIHApIHt9LFxuICAgICAgICBsaXN0UmVuZGVyZXI6IGZ1bmN0aW9uKGNoaWxkcmVuLCBvcHRpb25zKSB7XG4gICAgICAgICAgICB2YXIgaHRtbCA9ICc8JyArIG9wdGlvbnMubGlzdE5vZGVOYW1lICsgJyBjbGFzcz1cIicgKyBvcHRpb25zLmxpc3RDbGFzcyArICdcIj4nO1xuICAgICAgICAgICAgaHRtbCArPSBjaGlsZHJlbjtcbiAgICAgICAgICAgIGh0bWwgKz0gJzwvJyArIG9wdGlvbnMubGlzdE5vZGVOYW1lICsgJz4nO1xuXG4gICAgICAgICAgICByZXR1cm4gaHRtbDtcbiAgICAgICAgfSxcbiAgICAgICAgaXRlbVJlbmRlcmVyOiBmdW5jdGlvbihpdGVtX2F0dHJzLCBjb250ZW50LCBjaGlsZHJlbiwgb3B0aW9ucywgaXRlbSkge1xuICAgICAgICAgICAgdmFyIGl0ZW1fYXR0cnNfc3RyaW5nID0gJC5tYXAoaXRlbV9hdHRycywgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnICcgKyBrZXkgKyAnPVwiJyArIHZhbHVlICsgJ1wiJztcbiAgICAgICAgICAgIH0pLmpvaW4oJyAnKTtcblxuICAgICAgICAgICAgdmFyIGh0bWwgPSAnPCcgKyBvcHRpb25zLml0ZW1Ob2RlTmFtZSArIGl0ZW1fYXR0cnNfc3RyaW5nICsgJz4nO1xuICAgICAgICAgICAgaHRtbCArPSAnPCcgKyBvcHRpb25zLmhhbmRsZU5vZGVOYW1lICsgJyBjbGFzcz1cIicgKyBvcHRpb25zLmhhbmRsZUNsYXNzICsgJ1wiPic7XG4gICAgICAgICAgICBodG1sICs9ICc8JyArIG9wdGlvbnMuY29udGVudE5vZGVOYW1lICsgJyBjbGFzcz1cIicgKyBvcHRpb25zLmNvbnRlbnRDbGFzcyArICdcIj4nO1xuICAgICAgICAgICAgaHRtbCArPSBjb250ZW50O1xuICAgICAgICAgICAgaHRtbCArPSAnPC8nICsgb3B0aW9ucy5jb250ZW50Tm9kZU5hbWUgKyAnPic7XG4gICAgICAgICAgICBodG1sICs9ICc8LycgKyBvcHRpb25zLmhhbmRsZU5vZGVOYW1lICsgJz4nO1xuICAgICAgICAgICAgaHRtbCArPSBjaGlsZHJlbjtcbiAgICAgICAgICAgIGh0bWwgKz0gJzwvJyArIG9wdGlvbnMuaXRlbU5vZGVOYW1lICsgJz4nO1xuXG4gICAgICAgICAgICByZXR1cm4gaHRtbDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBQbHVnaW4oZWxlbWVudCwgb3B0aW9ucykge1xuICAgICAgICB0aGlzLncgID0gJChkb2N1bWVudCk7XG4gICAgICAgIHRoaXMuZWwgPSAkKGVsZW1lbnQpO1xuICAgICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCBkZWZhdWx0cztcblxuICAgICAgICBpZiAob3B0aW9ucy5yb290Q2xhc3MgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLnJvb3RDbGFzcyAhPT0gJ2RkJykge1xuICAgICAgICAgICAgb3B0aW9ucy5saXN0Q2xhc3MgICAgICAgPSBvcHRpb25zLmxpc3RDbGFzcyA/IG9wdGlvbnMubGlzdENsYXNzIDogb3B0aW9ucy5yb290Q2xhc3MgKyAnLWxpc3QnO1xuICAgICAgICAgICAgb3B0aW9ucy5pdGVtQ2xhc3MgICAgICAgPSBvcHRpb25zLml0ZW1DbGFzcyA/IG9wdGlvbnMuaXRlbUNsYXNzIDogb3B0aW9ucy5yb290Q2xhc3MgKyAnLWl0ZW0nO1xuICAgICAgICAgICAgb3B0aW9ucy5kcmFnQ2xhc3MgICAgICAgPSBvcHRpb25zLmRyYWdDbGFzcyA/IG9wdGlvbnMuZHJhZ0NsYXNzIDogb3B0aW9ucy5yb290Q2xhc3MgKyAnLWRyYWdlbCc7XG4gICAgICAgICAgICBvcHRpb25zLmhhbmRsZUNsYXNzICAgICA9IG9wdGlvbnMuaGFuZGxlQ2xhc3MgPyBvcHRpb25zLmhhbmRsZUNsYXNzIDogb3B0aW9ucy5yb290Q2xhc3MgKyAnLWhhbmRsZSc7XG4gICAgICAgICAgICBvcHRpb25zLmNvbGxhcHNlZENsYXNzICA9IG9wdGlvbnMuY29sbGFwc2VkQ2xhc3MgPyBvcHRpb25zLmNvbGxhcHNlZENsYXNzIDogb3B0aW9ucy5yb290Q2xhc3MgKyAnLWNvbGxhcHNlZCc7XG4gICAgICAgICAgICBvcHRpb25zLnBsYWNlQ2xhc3MgICAgICA9IG9wdGlvbnMucGxhY2VDbGFzcyA/IG9wdGlvbnMucGxhY2VDbGFzcyA6IG9wdGlvbnMucm9vdENsYXNzICsgJy1wbGFjZWhvbGRlcic7XG4gICAgICAgICAgICBvcHRpb25zLm5vRHJhZ0NsYXNzICAgICA9IG9wdGlvbnMubm9EcmFnQ2xhc3MgPyBvcHRpb25zLm5vRHJhZ0NsYXNzIDogb3B0aW9ucy5yb290Q2xhc3MgKyAnLW5vZHJhZyc7XG4gICAgICAgICAgICBvcHRpb25zLm5vQ2hpbGRyZW5DbGFzcyA9IG9wdGlvbnMubm9DaGlsZHJlbkNsYXNzID8gb3B0aW9ucy5ub0NoaWxkcmVuQ2xhc3MgOiBvcHRpb25zLnJvb3RDbGFzcyArICctbm9jaGlsZHJlbic7XG4gICAgICAgICAgICBvcHRpb25zLmVtcHR5Q2xhc3MgICAgICA9IG9wdGlvbnMuZW1wdHlDbGFzcyA/IG9wdGlvbnMuZW1wdHlDbGFzcyA6IG9wdGlvbnMucm9vdENsYXNzICsgJy1lbXB0eSc7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIG9wdGlvbnMpO1xuXG4gICAgICAgIC8vIGJ1aWxkIEhUTUwgZnJvbSBzZXJpYWxpemVkIEpTT04gaWYgcGFzc2VkXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuanNvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLl9idWlsZCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5pbml0KCk7XG4gICAgfVxuXG4gICAgUGx1Z2luLnByb3RvdHlwZSA9IHtcblxuICAgICAgICBpbml0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBsaXN0ID0gdGhpcztcblxuICAgICAgICAgICAgbGlzdC5yZXNldCgpO1xuICAgICAgICAgICAgbGlzdC5lbC5kYXRhKCduZXN0YWJsZS1ncm91cCcsIHRoaXMub3B0aW9ucy5ncm91cCk7XG4gICAgICAgICAgICBsaXN0LnBsYWNlRWwgPSAkKCc8ZGl2IGNsYXNzPVwiJyArIGxpc3Qub3B0aW9ucy5wbGFjZUNsYXNzICsgJ1wiLz4nKTtcblxuICAgICAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5lbC5maW5kKGxpc3Qub3B0aW9ucy5pdGVtTm9kZU5hbWUpO1xuICAgICAgICAgICAgJC5lYWNoKGl0ZW1zLCBmdW5jdGlvbihrLCBlbCkge1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0gJChlbCksXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudCA9IGl0ZW0ucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgbGlzdC5zZXRQYXJlbnQoaXRlbSk7XG4gICAgICAgICAgICAgICAgaWYgKHBhcmVudC5oYXNDbGFzcyhsaXN0Lm9wdGlvbnMuY29sbGFwc2VkQ2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QuY29sbGFwc2VJdGVtKHBhcmVudC5wYXJlbnQoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIEFwcGVuZCB0aGUgLmRkLWVtcHR5IGRpdiBpZiB0aGUgbGlzdCBkb24ndCBoYXZlIGFueSBpdGVtcyBvbiBpbml0XG4gICAgICAgICAgICBpZiAoIWl0ZW1zLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kRW1wdHlFbGVtZW50KHRoaXMuZWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsaXN0LmVsLm9uKCdjbGljaycsICdidXR0b24nLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxpc3QuZHJhZ0VsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHRhcmdldCA9ICQoZS5jdXJyZW50VGFyZ2V0KSxcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gdGFyZ2V0LmRhdGEoJ2FjdGlvbicpLFxuICAgICAgICAgICAgICAgICAgICBpdGVtID0gdGFyZ2V0LnBhcmVudHMobGlzdC5vcHRpb25zLml0ZW1Ob2RlTmFtZSkuZXEoMCk7XG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2NvbGxhcHNlJykge1xuICAgICAgICAgICAgICAgICAgICBsaXN0LmNvbGxhcHNlSXRlbShpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2V4cGFuZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5leHBhbmRJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB2YXIgb25TdGFydEV2ZW50ID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIHZhciBoYW5kbGUgPSAkKGUudGFyZ2V0KTtcbiAgICAgICAgICAgICAgICBpZiAoIWhhbmRsZS5oYXNDbGFzcyhsaXN0Lm9wdGlvbnMuaGFuZGxlQ2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGUuY2xvc2VzdCgnLicgKyBsaXN0Lm9wdGlvbnMubm9EcmFnQ2xhc3MpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZSA9IGhhbmRsZS5jbG9zZXN0KCcuJyArIGxpc3Qub3B0aW9ucy5oYW5kbGVDbGFzcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghaGFuZGxlLmxlbmd0aCB8fCBsaXN0LmRyYWdFbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGlzdC5pc1RvdWNoID0gL150b3VjaC8udGVzdChlLnR5cGUpO1xuICAgICAgICAgICAgICAgIGlmIChsaXN0LmlzVG91Y2ggJiYgZS50b3VjaGVzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGxpc3QuZHJhZ1N0YXJ0KGUudG91Y2hlcyA/IGUudG91Y2hlc1swXSA6IGUpO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uTW92ZUV2ZW50ID0gZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgIGlmIChsaXN0LmRyYWdFbCkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QuZHJhZ01vdmUoZS50b3VjaGVzID8gZS50b3VjaGVzWzBdIDogZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIG9uRW5kRXZlbnQgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxpc3QuZHJhZ0VsKSB7XG4gICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5kcmFnU3RvcChlLnRvdWNoZXMgPyBlLmNoYW5nZWRUb3VjaGVzWzBdIDogZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgaWYgKGhhc1RvdWNoKSB7XG4gICAgICAgICAgICAgICAgbGlzdC5lbFswXS5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0Jywgb25TdGFydEV2ZW50LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIG9uTW92ZUV2ZW50LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgb25FbmRFdmVudCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGNhbmNlbCcsIG9uRW5kRXZlbnQsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGlzdC5lbC5vbignbW91c2Vkb3duJywgb25TdGFydEV2ZW50KTtcbiAgICAgICAgICAgIGxpc3Qudy5vbignbW91c2Vtb3ZlJywgb25Nb3ZlRXZlbnQpO1xuICAgICAgICAgICAgbGlzdC53Lm9uKCdtb3VzZXVwJywgb25FbmRFdmVudCk7XG5cbiAgICAgICAgICAgIHZhciBkZXN0cm95TmVzdGFibGUgPSBmdW5jdGlvbigpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgaWYgKGhhc1RvdWNoKSB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QuZWxbMF0ucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIG9uU3RhcnRFdmVudCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2htb3ZlJywgb25Nb3ZlRXZlbnQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgb25FbmRFdmVudCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigndG91Y2hjYW5jZWwnLCBvbkVuZEV2ZW50LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbGlzdC5lbC5vZmYoJ21vdXNlZG93bicsIG9uU3RhcnRFdmVudCk7XG4gICAgICAgICAgICAgICAgbGlzdC53Lm9mZignbW91c2Vtb3ZlJywgb25Nb3ZlRXZlbnQpO1xuICAgICAgICAgICAgICAgIGxpc3Qudy5vZmYoJ21vdXNldXAnLCBvbkVuZEV2ZW50KTtcblxuICAgICAgICAgICAgICAgIGxpc3QuZWwub2ZmKCdjbGljaycpO1xuICAgICAgICAgICAgICAgIGxpc3QuZWwudW5iaW5kKCdkZXN0cm95LW5lc3RhYmxlJyk7XG5cbiAgICAgICAgICAgICAgICBsaXN0LmVsLmRhdGEoXCJuZXN0YWJsZVwiLCBudWxsKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGxpc3QuZWwuYmluZCgnZGVzdHJveS1uZXN0YWJsZScsIGRlc3Ryb3lOZXN0YWJsZSk7XG5cbiAgICAgICAgfSxcblxuICAgICAgICBkZXN0cm95OiBmdW5jdGlvbiAoKVxuICAgICAgICB7XG4gICAgICAgICAgICB0aGlzLmVsLnRyaWdnZXIoJ2Rlc3Ryb3ktbmVzdGFibGUnKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhZGQ6IGZ1bmN0aW9uIChpdGVtKVxuICAgICAgICB7XG4gICAgICAgICAgICB2YXIgbGlzdENsYXNzU2VsZWN0b3IgPSAnLicgKyB0aGlzLm9wdGlvbnMubGlzdENsYXNzO1xuICAgICAgICAgICAgdmFyIHRyZWUgPSAkKHRoaXMuZWwpLmNoaWxkcmVuKGxpc3RDbGFzc1NlbGVjdG9yKTtcblxuICAgICAgICAgICAgaWYgKGl0ZW0ucGFyZW50X2lkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0cmVlID0gdHJlZS5maW5kKCdbZGF0YS1pZD1cIicgKyBpdGVtLnBhcmVudF9pZCArICdcIl0nKTtcbiAgICAgICAgICAgICAgICBkZWxldGUgaXRlbS5wYXJlbnRfaWQ7XG5cbiAgICAgICAgICAgICAgICBpZiAodHJlZS5jaGlsZHJlbihsaXN0Q2xhc3NTZWxlY3RvcikubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRyZWUgPSB0cmVlLmFwcGVuZCh0aGlzLm9wdGlvbnMubGlzdFJlbmRlcmVyKCcnLCB0aGlzLm9wdGlvbnMpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0cmVlID0gdHJlZS5maW5kKGxpc3RDbGFzc1NlbGVjdG9yICsgJzpmaXJzdCcpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0UGFyZW50KHRyZWUucGFyZW50KCkpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0cmVlLmFwcGVuZCh0aGlzLl9idWlsZEl0ZW0oaXRlbSwgdGhpcy5vcHRpb25zKSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVwbGFjZTogZnVuY3Rpb24gKGl0ZW0pXG4gICAgICAgIHtcbiAgICAgICAgICAgIHZhciBodG1sID0gdGhpcy5fYnVpbGRJdGVtKGl0ZW0sIHRoaXMub3B0aW9ucyk7XG5cbiAgICAgICAgICAgIHRoaXMuX2dldEl0ZW1CeUlkKGl0ZW0uaWQpXG4gICAgICAgICAgICAgICAgLnJlcGxhY2VXaXRoKGh0bWwpO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vcmVtb3ZlcyBpdGVtIGFuZCBhZGRpdGlvbmFsIGVsZW1lbnRzIGZyb20gbGlzdFxuICAgICAgICByZW1vdmVJdGVtOiBmdW5jdGlvbiAoaXRlbSl7XG4gICAgICAgICAgICB2YXIgb3B0cyA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBlbCAgID0gdGhpcy5lbDtcblxuICAgICAgICAgICAgLy8gcmVtb3ZlIGl0ZW1cbiAgICAgICAgICAgIGl0ZW0gPSBpdGVtIHx8IHRoaXM7XG4gICAgICAgICAgICBpdGVtLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAvLyByZW1vdmUgZW1wdHkgY2hpbGRyZW4gbGlzdHNcbiAgICAgICAgICAgIHZhciBlbXB0eUxpc3RzU2VsZWN0b3IgPSAnLicgKyBvcHRzLmxpc3RDbGFzc1xuICAgICAgICAgICAgICAgICsgJyAuJyArIG9wdHMubGlzdENsYXNzICsgJzpub3QoOmhhcygqKSknO1xuICAgICAgICAgICAgJChlbCkuZmluZChlbXB0eUxpc3RzU2VsZWN0b3IpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAvLyByZW1vdmUgYnV0dG9ucyBpZiBwYXJlbnRzIGRvIG5vdCBoYXZlIGNoaWxkcmVuXG4gICAgICAgICAgICB2YXIgYnV0dG9uc1NlbGVjdG9yID0gJ1tkYXRhLWFjdGlvbj1cImV4cGFuZFwiXSwgW2RhdGEtYWN0aW9uPVwiY29sbGFwc2VcIl0nO1xuICAgICAgICAgICAgJChlbCkuZmluZChidXR0b25zU2VsZWN0b3IpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNpYmxpbmdzID0gJCh0aGlzKS5zaWJsaW5ncygnLicgKyBvcHRzLmxpc3RDbGFzcyk7XG4gICAgICAgICAgICAgICAgaWYgKHNpYmxpbmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIC8vcmVtb3ZlcyBpdGVtIGJ5IGl0ZW1JZCBhbmQgcnVuIGNhbGxiYWNrIGF0IHRoZSBlbmRcbiAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbiAoaXRlbUlkLCBjYWxsYmFjaylcbiAgICAgICAge1xuICAgICAgICAgICAgdmFyIG9wdHMgPSB0aGlzLm9wdGlvbnM7XG4gICAgICAgICAgICB2YXIgbGlzdCA9IHRoaXM7XG4gICAgICAgICAgICB2YXIgaXRlbSA9IHRoaXMuX2dldEl0ZW1CeUlkKGl0ZW1JZCk7XG5cbiAgICAgICAgICAgIC8vYW5pbWF0aW9uIHN0eWxlXG4gICAgICAgICAgICB2YXIgYW5pbWF0aW9uID0gb3B0cy5lZmZlY3QuYW5pbWF0aW9uIHx8ICdmYWRlJztcblxuICAgICAgICAgICAgLy9hbmltYXRpb24gdGltZVxuICAgICAgICAgICAgdmFyIHRpbWUgPSBvcHRzLmVmZmVjdC50aW1lIHx8ICdzbG93JztcblxuICAgICAgICAgICAgLy9hZGQgZmFkZU91dCBlZmZlY3Qgd2hlbiByZW1vdmluZ1xuICAgICAgICAgICAgaWYgKGFuaW1hdGlvbiA9PT0gJ2ZhZGUnKXtcbiAgICAgICAgICAgICAgICBpdGVtLmZhZGVPdXQodGltZSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgbGlzdC5yZW1vdmVJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVJdGVtKGl0ZW0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy9yZW1vdmVzIGFsbCBpdGVtcyBmcm9tIHRoZSBsaXN0IGFuZCBydW4gY2FsbGJhY2sgYXQgdGhlIGVuZFxuICAgICAgICByZW1vdmVBbGw6IGZ1bmN0aW9uKGNhbGxiYWNrKXtcblxuICAgICAgICAgICAgdmFyIGxpc3QgID0gdGhpcyxcbiAgICAgICAgICAgICAgICBvcHRzICA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBub2RlICA9IGxpc3QuZWwuZmluZChvcHRzLmxpc3ROb2RlTmFtZSkuZmlyc3QoKSxcbiAgICAgICAgICAgICAgICBpdGVtcyA9IG5vZGUuY2hpbGRyZW4ob3B0cy5pdGVtTm9kZU5hbWUpO1xuXG4gICAgICAgICAgICAvL2FuaW1hdGlvbiBzdHlsZVxuICAgICAgICAgICAgdmFyIGFuaW1hdGlvbiA9IG9wdHMuZWZmZWN0LmFuaW1hdGlvbiB8fCAnZmFkZSc7XG5cbiAgICAgICAgICAgIC8vYW5pbWF0aW9uIHRpbWVcbiAgICAgICAgICAgIHZhciB0aW1lID0gb3B0cy5lZmZlY3QudGltZSB8fCAnc2xvdyc7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHJlbW92ZSgpe1xuICAgICAgICAgICAgICAgIC8vUmVtb3ZlcyBlYWNoIGl0ZW0gYW5kIGl0cyBjaGlsZHJlbi5cbiAgICAgICAgICAgICAgICBpdGVtcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBsaXN0LnJlbW92ZUl0ZW0oJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgLy9Ob3cgd2UgY2FuIGFnYWluIHNob3cgb3VyIG5vZGUgZWxlbWVudFxuICAgICAgICAgICAgICAgIG5vZGUuc2hvdygpO1xuICAgICAgICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy9hZGQgZmFkZU91dCBlZmZlY3Qgd2hlbiByZW1vdmluZ1xuICAgICAgICAgICAgaWYgKGFuaW1hdGlvbiA9PT0gJ2ZhZGUnKXtcbiAgICAgICAgICAgICAgICBub2RlLmZhZGVPdXQodGltZSwgcmVtb3ZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlbW92ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIF9nZXRJdGVtQnlJZDogZnVuY3Rpb24oaXRlbUlkKSB7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzLmVsKS5jaGlsZHJlbignLicgKyB0aGlzLm9wdGlvbnMubGlzdENsYXNzKVxuICAgICAgICAgICAgICAgIC5maW5kKCdbZGF0YS1pZD1cIicgKyBpdGVtSWQgKyAnXCJdJyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2J1aWxkOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBqc29uID0gdGhpcy5vcHRpb25zLmpzb247XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YganNvbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICBqc29uID0gSlNPTi5wYXJzZShqc29uKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJCh0aGlzLmVsKS5odG1sKHRoaXMuX2J1aWxkTGlzdChqc29uLCB0aGlzLm9wdGlvbnMpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBfYnVpbGRMaXN0OiBmdW5jdGlvbihpdGVtcywgb3B0aW9ucykge1xuICAgICAgICAgICAgaWYgKCFpdGVtcykge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gJyc7XG4gICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXM7XG5cbiAgICAgICAgICAgICQuZWFjaChpdGVtcywgZnVuY3Rpb24oaW5kZXgsIHN1Yikge1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuICs9IHRoYXQuX2J1aWxkSXRlbShzdWIsIG9wdGlvbnMpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBvcHRpb25zLmxpc3RSZW5kZXJlcihjaGlsZHJlbiwgb3B0aW9ucyk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgX2J1aWxkSXRlbTogZnVuY3Rpb24oaXRlbSwgb3B0aW9ucykge1xuICAgICAgICAgICAgZnVuY3Rpb24gZXNjYXBlSHRtbCh0ZXh0KSB7XG4gICAgICAgICAgICAgICAgdmFyIG1hcCA9IHtcbiAgICAgICAgICAgICAgICAgICAgJyYnOiAnJmFtcDsnLFxuICAgICAgICAgICAgICAgICAgICAnPCc6ICcmbHQ7JyxcbiAgICAgICAgICAgICAgICAgICAgJz4nOiAnJmd0OycsXG4gICAgICAgICAgICAgICAgICAgICdcIic6ICcmcXVvdDsnLFxuICAgICAgICAgICAgICAgICAgICBcIidcIjogJyYjMDM5OydcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRleHQgKyBcIlwiLnJlcGxhY2UoL1smPD5cIiddL2csIGZ1bmN0aW9uKG0pIHsgcmV0dXJuIG1hcFttXTsgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGZpbHRlckNsYXNzZXMoY2xhc3Nlcykge1xuICAgICAgICAgICAgICAgIHZhciBuZXdfY2xhc3NlcyA9IHt9O1xuXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgayBpbiBjbGFzc2VzKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzXG4gICAgICAgICAgICAgICAgICAgIG5ld19jbGFzc2VzW2NsYXNzZXNba11dID0gY2xhc3Nlc1trXTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3X2NsYXNzZXM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUNsYXNzZXNTdHJpbmcoaXRlbSwgb3B0aW9ucykge1xuICAgICAgICAgICAgICAgIHZhciBjbGFzc2VzID0gaXRlbS5jbGFzc2VzIHx8IHt9O1xuXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjbGFzc2VzID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBjbGFzc2VzID0gW2NsYXNzZXNdO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBpdGVtX2NsYXNzZXMgPSBmaWx0ZXJDbGFzc2VzKGNsYXNzZXMpO1xuICAgICAgICAgICAgICAgIGl0ZW1fY2xhc3Nlc1tvcHRpb25zLml0ZW1DbGFzc10gPSBvcHRpb25zLml0ZW1DbGFzcztcblxuICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBjbGFzcyBzdHJpbmdcbiAgICAgICAgICAgICAgICByZXR1cm4gJC5tYXAoaXRlbV9jbGFzc2VzLCBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbDtcbiAgICAgICAgICAgICAgICB9KS5qb2luKCcgJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZURhdGFBdHRycyhhdHRyKSB7XG4gICAgICAgICAgICAgICAgYXR0ciA9ICQuZXh0ZW5kKHt9LCBhdHRyKTtcblxuICAgICAgICAgICAgICAgIGRlbGV0ZSBhdHRyLmNoaWxkcmVuO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBhdHRyLmNsYXNzZXM7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGF0dHIuY29udGVudDtcblxuICAgICAgICAgICAgICAgIHZhciBkYXRhX2F0dHJzID0ge307XG5cbiAgICAgICAgICAgICAgICAkLmVhY2goYXR0ciwgZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICBkYXRhX2F0dHJzW1wiZGF0YS1cIiArIGtleV0gPSBlc2NhcGVIdG1sKHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhX2F0dHJzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgaXRlbV9hdHRycyA9IGNyZWF0ZURhdGFBdHRycyhpdGVtKTtcbiAgICAgICAgICAgIGl0ZW1fYXR0cnNbXCJjbGFzc1wiXSA9IGNyZWF0ZUNsYXNzZXNTdHJpbmcoaXRlbSwgb3B0aW9ucyk7XG5cbiAgICAgICAgICAgIHZhciBjb250ZW50ID0gb3B0aW9ucy5jb250ZW50Q2FsbGJhY2soaXRlbSk7XG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLl9idWlsZExpc3QoaXRlbS5jaGlsZHJlbiwgb3B0aW9ucyk7XG4gICAgICAgICAgICB2YXIgaHRtbCA9ICQob3B0aW9ucy5pdGVtUmVuZGVyZXIoaXRlbV9hdHRycywgY29udGVudCwgY2hpbGRyZW4sIG9wdGlvbnMsIGl0ZW0pKTtcblxuICAgICAgICAgICAgdGhpcy5zZXRQYXJlbnQoaHRtbCk7XG5cbiAgICAgICAgICAgIHJldHVybiBodG1sWzBdLm91dGVySFRNTDtcbiAgICAgICAgfSxcblxuICAgICAgICBzZXJpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGRhdGEsIGxpc3QgPSB0aGlzLCBzdGVwID0gZnVuY3Rpb24obGV2ZWwpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXJyYXkgPSBbXSxcbiAgICAgICAgICAgICAgICAgICAgaXRlbXMgPSBsZXZlbC5jaGlsZHJlbihsaXN0Lm9wdGlvbnMuaXRlbU5vZGVOYW1lKTtcbiAgICAgICAgICAgICAgICBpdGVtcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGkgPSAkKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbSA9ICQuZXh0ZW5kKHt9LCBsaS5kYXRhKCkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3ViID0gbGkuY2hpbGRyZW4obGlzdC5vcHRpb25zLmxpc3ROb2RlTmFtZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGxpc3Qub3B0aW9ucy5pbmNsdWRlQ29udGVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBsaS5maW5kKCcuJyArIGxpc3Qub3B0aW9ucy5jb250ZW50Q2xhc3MpLmh0bWwoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbnRlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtLmNvbnRlbnQgPSBjb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHN1Yi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uY2hpbGRyZW4gPSBzdGVwKHN1Yik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYXJyYXkucHVzaChpdGVtKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYXJyYXk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZGF0YSA9IHN0ZXAobGlzdC5lbC5maW5kKGxpc3Qub3B0aW9ucy5saXN0Tm9kZU5hbWUpLmZpcnN0KCkpO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYXNOZXN0ZWRTZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGxpc3QgPSB0aGlzLCBvID0gbGlzdC5vcHRpb25zLCBkZXB0aCA9IC0xLCByZXQgPSBbXSwgbGZ0ID0gMTtcbiAgICAgICAgICAgIHZhciBpdGVtcyA9IGxpc3QuZWwuZmluZChvLmxpc3ROb2RlTmFtZSkuZmlyc3QoKS5jaGlsZHJlbihvLml0ZW1Ob2RlTmFtZSk7XG5cbiAgICAgICAgICAgIGl0ZW1zLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGxmdCA9IHRyYXZlcnNlKHRoaXMsIGRlcHRoICsgMSwgbGZ0KTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXQgPSByZXQuc29ydChmdW5jdGlvbihhLGIpeyByZXR1cm4gKGEubGZ0IC0gYi5sZnQpOyB9KTtcbiAgICAgICAgICAgIHJldHVybiByZXQ7XG5cbiAgICAgICAgICAgIGZ1bmN0aW9uIHRyYXZlcnNlKGl0ZW0sIGRlcHRoLCBsZnQpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmd0ID0gbGZ0ICsgMSwgaWQsIHBpZDtcblxuICAgICAgICAgICAgICAgIGlmICgkKGl0ZW0pLmNoaWxkcmVuKG8ubGlzdE5vZGVOYW1lKS5jaGlsZHJlbihvLml0ZW1Ob2RlTmFtZSkubGVuZ3RoID4gMCApIHtcbiAgICAgICAgICAgICAgICAgICAgZGVwdGgrKztcbiAgICAgICAgICAgICAgICAgICAgJChpdGVtKS5jaGlsZHJlbihvLmxpc3ROb2RlTmFtZSkuY2hpbGRyZW4oby5pdGVtTm9kZU5hbWUpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmd0ID0gdHJhdmVyc2UoJCh0aGlzKSwgZGVwdGgsIHJndCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBkZXB0aC0tO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlkID0gJChpdGVtKS5hdHRyKCdkYXRhLWlkJyk7XG4gICAgICAgICAgICAgICAgaWYgKGlzSW50KGlkKSkge1xuICAgICAgICAgICAgICAgICAgICBpZCA9IHBhcnNlSW50KGlkKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBwaWQgPSAkKGl0ZW0pLnBhcmVudChvLmxpc3ROb2RlTmFtZSkucGFyZW50KG8uaXRlbU5vZGVOYW1lKS5hdHRyKCdkYXRhLWlkJykgfHwgJyc7XG4gICAgICAgICAgICAgICAgaWYgKGlzSW50KHBpZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWQgPSBwYXJzZUludChwaWQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmIChpZCkge1xuICAgICAgICAgICAgICAgICAgICByZXQucHVzaCh7XCJpZFwiOiBpZCwgXCJwYXJlbnRfaWRcIjogcGlkLCBcImRlcHRoXCI6IGRlcHRoLCBcImxmdFwiOiBsZnQsIFwicmd0XCI6IHJndH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGxmdCA9IHJndCArIDE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxmdDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZnVuY3Rpb24gaXNJbnQodmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJC5pc051bWVyaWModmFsdWUpICYmIE1hdGguZmxvb3IodmFsdWUpID09IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHJldHVybk9wdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucztcbiAgICAgICAgfSxcblxuICAgICAgICBzZXJpYWxpc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc2VyaWFsaXplKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9IaWVyYXJjaHk6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblxuICAgICAgICAgICAgdmFyIG8gPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKSxcbiAgICAgICAgICAgICAgICByZXQgPSBbXTtcblxuICAgICAgICAgICAgJCh0aGlzLmVsZW1lbnQpLmNoaWxkcmVuKG8uaXRlbXMpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdmFyIGxldmVsID0gX3JlY3Vyc2l2ZUl0ZW1zKHRoaXMpO1xuICAgICAgICAgICAgICAgIHJldC5wdXNoKGxldmVsKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBfcmVjdXJzaXZlSXRlbXMoaXRlbSkge1xuICAgICAgICAgICAgICAgIHZhciBpZCA9ICgkKGl0ZW0pLmF0dHIoby5hdHRyaWJ1dGUgfHwgJ2lkJykgfHwgJycpLm1hdGNoKG8uZXhwcmVzc2lvbiB8fCAoLyguKylbLT1fXSguKykvKSk7XG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50SXRlbSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogaWRbMl1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoaXRlbSkuY2hpbGRyZW4oby5saXN0VHlwZSkuY2hpbGRyZW4oby5pdGVtcykubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEl0ZW0uY2hpbGRyZW4gPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoaXRlbSkuY2hpbGRyZW4oby5saXN0VHlwZSkuY2hpbGRyZW4oby5pdGVtcykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGV2ZWwgPSBfcmVjdXJzaXZlSXRlbXModGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudEl0ZW0uY2hpbGRyZW4ucHVzaChsZXZlbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudEl0ZW07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIHRvQXJyYXk6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICB2YXIgbyA9ICQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMsIHRoaXMpLFxuICAgICAgICAgICAgICAgIHNEZXB0aCA9IG8uc3RhcnREZXB0aENvdW50IHx8IDAsXG4gICAgICAgICAgICAgICAgcmV0ID0gW10sXG4gICAgICAgICAgICAgICAgbGVmdCA9IDIsXG4gICAgICAgICAgICAgICAgbGlzdCA9IHRoaXMsXG4gICAgICAgICAgICAgICAgZWxlbWVudCA9IGxpc3QuZWwuZmluZChsaXN0Lm9wdGlvbnMubGlzdE5vZGVOYW1lKS5maXJzdCgpO1xuXG4gICAgICAgICAgICB2YXIgaXRlbXMgPSBlbGVtZW50LmNoaWxkcmVuKGxpc3Qub3B0aW9ucy5pdGVtTm9kZU5hbWUpO1xuICAgICAgICAgICAgaXRlbXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBsZWZ0ID0gX3JlY3Vyc2l2ZUFycmF5KCQodGhpcyksIHNEZXB0aCArIDEsIGxlZnQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldCA9IHJldC5zb3J0KGZ1bmN0aW9uKGEsIGIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGEubGVmdCAtIGIubGVmdCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIHJldDtcblxuICAgICAgICAgICAgZnVuY3Rpb24gX3JlY3Vyc2l2ZUFycmF5KGl0ZW0sIGRlcHRoLCBsZWZ0KSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmlnaHQgPSBsZWZ0ICsgMSxcbiAgICAgICAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgICAgICAgIHBpZDtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmNoaWxkcmVuKG8ub3B0aW9ucy5saXN0Tm9kZU5hbWUpLmNoaWxkcmVuKG8ub3B0aW9ucy5pdGVtTm9kZU5hbWUpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgZGVwdGgrKztcbiAgICAgICAgICAgICAgICAgICAgaXRlbS5jaGlsZHJlbihvLm9wdGlvbnMubGlzdE5vZGVOYW1lKS5jaGlsZHJlbihvLm9wdGlvbnMuaXRlbU5vZGVOYW1lKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmlnaHQgPSBfcmVjdXJzaXZlQXJyYXkoJCh0aGlzKSwgZGVwdGgsIHJpZ2h0KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGRlcHRoLS07XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWQgPSBpdGVtLmRhdGEoKS5pZDtcblxuXG4gICAgICAgICAgICAgICAgaWYgKGRlcHRoID09PSBzRGVwdGggKyAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHBpZCA9IG8ucm9vdElEO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudEl0ZW0gPSAoaXRlbS5wYXJlbnQoby5vcHRpb25zLmxpc3ROb2RlTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wYXJlbnQoby5vcHRpb25zLml0ZW1Ob2RlTmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5kYXRhKCkpO1xuICAgICAgICAgICAgICAgICAgICBwaWQgPSBwYXJlbnRJdGVtLmlkO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgaWYgKGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiaWRcIjogaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInBhcmVudF9pZFwiOiBwaWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImRlcHRoXCI6IGRlcHRoLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJsZWZ0XCI6IGxlZnQsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInJpZ2h0XCI6IHJpZ2h0XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGxlZnQgPSByaWdodCArIDE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGxlZnQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcblxuICAgICAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB0aGlzLm1vdXNlID0ge1xuICAgICAgICAgICAgICAgIG9mZnNldFg6IDAsXG4gICAgICAgICAgICAgICAgb2Zmc2V0WTogMCxcbiAgICAgICAgICAgICAgICBzdGFydFg6IDAsXG4gICAgICAgICAgICAgICAgc3RhcnRZOiAwLFxuICAgICAgICAgICAgICAgIGxhc3RYOiAwLFxuICAgICAgICAgICAgICAgIGxhc3RZOiAwLFxuICAgICAgICAgICAgICAgIG5vd1g6IDAsXG4gICAgICAgICAgICAgICAgbm93WTogMCxcbiAgICAgICAgICAgICAgICBkaXN0WDogMCxcbiAgICAgICAgICAgICAgICBkaXN0WTogMCxcbiAgICAgICAgICAgICAgICBkaXJBeDogMCxcbiAgICAgICAgICAgICAgICBkaXJYOiAwLFxuICAgICAgICAgICAgICAgIGRpclk6IDAsXG4gICAgICAgICAgICAgICAgbGFzdERpclg6IDAsXG4gICAgICAgICAgICAgICAgbGFzdERpclk6IDAsXG4gICAgICAgICAgICAgICAgZGlzdEF4WDogMCxcbiAgICAgICAgICAgICAgICBkaXN0QXhZOiAwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5pc1RvdWNoID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLm1vdmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5kcmFnRWwgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5kcmFnUm9vdEVsID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMuZHJhZ0RlcHRoID0gMDtcbiAgICAgICAgICAgIHRoaXMuaGFzTmV3Um9vdCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5wb2ludEVsID0gbnVsbDtcbiAgICAgICAgfSxcblxuICAgICAgICBleHBhbmRJdGVtOiBmdW5jdGlvbihsaSkge1xuICAgICAgICAgICAgbGkucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLmNvbGxhcHNlZENsYXNzKTtcbiAgICAgICAgfSxcblxuICAgICAgICBjb2xsYXBzZUl0ZW06IGZ1bmN0aW9uKGxpKSB7XG4gICAgICAgICAgICB2YXIgbGlzdHMgPSBsaS5jaGlsZHJlbih0aGlzLm9wdGlvbnMubGlzdE5vZGVOYW1lKTtcbiAgICAgICAgICAgIGlmIChsaXN0cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBsaS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMuY29sbGFwc2VkQ2xhc3MpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGV4cGFuZEFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgbGlzdCA9IHRoaXM7XG4gICAgICAgICAgICBsaXN0LmVsLmZpbmQobGlzdC5vcHRpb25zLml0ZW1Ob2RlTmFtZSkuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBsaXN0LmV4cGFuZEl0ZW0oJCh0aGlzKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBjb2xsYXBzZUFsbDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgbGlzdCA9IHRoaXM7XG4gICAgICAgICAgICBsaXN0LmVsLmZpbmQobGlzdC5vcHRpb25zLml0ZW1Ob2RlTmFtZSkuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBsaXN0LmNvbGxhcHNlSXRlbSgkKHRoaXMpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldFBhcmVudDogZnVuY3Rpb24obGkpIHtcbiAgICAgICAgICAgIC8vQ2hlY2sgaWYgbGkgaXMgYW4gZWxlbWVudCBvZiBpdGVtTm9kZU5hbWUgdHlwZSBhbmQgaGFzIGNoaWxkcmVuXG4gICAgICAgICAgICBpZiAobGkuaXModGhpcy5vcHRpb25zLml0ZW1Ob2RlTmFtZSkgJiYgbGkuY2hpbGRyZW4odGhpcy5vcHRpb25zLmxpc3ROb2RlTmFtZSkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgLy8gbWFrZSBzdXJlIE5PVCBzaG93aW5nIHR3byBvciBtb3JlIHNldHMgZGF0YS1hY3Rpb24gYnV0dG9uc1xuICAgICAgICAgICAgICAgIGxpLmNoaWxkcmVuKCdbZGF0YS1hY3Rpb25dJykucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgbGkucHJlcGVuZCgkKHRoaXMub3B0aW9ucy5leHBhbmRCdG5IVE1MKSk7XG4gICAgICAgICAgICAgICAgbGkucHJlcGVuZCgkKHRoaXMub3B0aW9ucy5jb2xsYXBzZUJ0bkhUTUwpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICB1bnNldFBhcmVudDogZnVuY3Rpb24obGkpIHtcbiAgICAgICAgICAgIGxpLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5jb2xsYXBzZWRDbGFzcyk7XG4gICAgICAgICAgICBsaS5jaGlsZHJlbignW2RhdGEtYWN0aW9uXScpLnJlbW92ZSgpO1xuICAgICAgICAgICAgbGkuY2hpbGRyZW4odGhpcy5vcHRpb25zLmxpc3ROb2RlTmFtZSkucmVtb3ZlKCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJhZ1N0YXJ0OiBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICB2YXIgbW91c2UgPSB0aGlzLm1vdXNlLFxuICAgICAgICAgICAgICAgIHRhcmdldCA9ICQoZS50YXJnZXQpLFxuICAgICAgICAgICAgICAgIGRyYWdJdGVtID0gdGFyZ2V0LmNsb3Nlc3QodGhpcy5vcHRpb25zLml0ZW1Ob2RlTmFtZSksXG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPSB7XG4gICAgICAgICAgICAgICAgICAgIHRvcCAgOiBlLnBhZ2VZLFxuICAgICAgICAgICAgICAgICAgICBsZWZ0IDogZS5wYWdlWFxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBjb250aW51ZUV4ZWN1dGlvbiA9IHRoaXMub3B0aW9ucy5vbkRyYWdTdGFydC5jYWxsKHRoaXMsIHRoaXMuZWwsIGRyYWdJdGVtLCBwb3NpdGlvbik7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgY29udGludWVFeGVjdXRpb24gIT09ICd1bmRlZmluZWQnICYmIGNvbnRpbnVlRXhlY3V0aW9uID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5wbGFjZUVsLmNzcygnaGVpZ2h0JywgZHJhZ0l0ZW0uaGVpZ2h0KCkpO1xuXG4gICAgICAgICAgICBtb3VzZS5vZmZzZXRYID0gZS5wYWdlWCAtIGRyYWdJdGVtLm9mZnNldCgpLmxlZnQ7XG4gICAgICAgICAgICBtb3VzZS5vZmZzZXRZID0gZS5wYWdlWSAtIGRyYWdJdGVtLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgIG1vdXNlLnN0YXJ0WCA9IG1vdXNlLmxhc3RYID0gZS5wYWdlWDtcbiAgICAgICAgICAgIG1vdXNlLnN0YXJ0WSA9IG1vdXNlLmxhc3RZID0gZS5wYWdlWTtcblxuICAgICAgICAgICAgdGhpcy5kcmFnUm9vdEVsID0gdGhpcy5lbDtcbiAgICAgICAgICAgIHRoaXMuZHJhZ0VsID0gJChkb2N1bWVudC5jcmVhdGVFbGVtZW50KHRoaXMub3B0aW9ucy5saXN0Tm9kZU5hbWUpKS5hZGRDbGFzcyh0aGlzLm9wdGlvbnMubGlzdENsYXNzICsgJyAnICsgdGhpcy5vcHRpb25zLmRyYWdDbGFzcyk7XG4gICAgICAgICAgICB0aGlzLmRyYWdFbC5jc3MoJ3dpZHRoJywgZHJhZ0l0ZW0ub3V0ZXJXaWR0aCgpKTtcblxuICAgICAgICAgICAgdGhpcy5zZXRJbmRleE9mSXRlbShkcmFnSXRlbSk7XG5cbiAgICAgICAgICAgIC8vIGZpeCBmb3IgemVwdG8uanNcbiAgICAgICAgICAgIC8vZHJhZ0l0ZW0uYWZ0ZXIodGhpcy5wbGFjZUVsKS5kZXRhY2goKS5hcHBlbmRUbyh0aGlzLmRyYWdFbCk7XG4gICAgICAgICAgICBkcmFnSXRlbS5hZnRlcih0aGlzLnBsYWNlRWwpO1xuICAgICAgICAgICAgZHJhZ0l0ZW1bMF0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkcmFnSXRlbVswXSk7XG4gICAgICAgICAgICBkcmFnSXRlbS5hcHBlbmRUbyh0aGlzLmRyYWdFbCk7XG5cbiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkuYXBwZW5kKHRoaXMuZHJhZ0VsKTtcbiAgICAgICAgICAgIHRoaXMuZHJhZ0VsLmNzcyh7XG4gICAgICAgICAgICAgICAgJ2xlZnQnOiBlLnBhZ2VYIC0gbW91c2Uub2Zmc2V0WCxcbiAgICAgICAgICAgICAgICAndG9wJzogZS5wYWdlWSAtIG1vdXNlLm9mZnNldFlcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gdG90YWwgZGVwdGggb2YgZHJhZ2dpbmcgaXRlbVxuICAgICAgICAgICAgdmFyIGksIGRlcHRoLFxuICAgICAgICAgICAgICAgIGl0ZW1zID0gdGhpcy5kcmFnRWwuZmluZCh0aGlzLm9wdGlvbnMuaXRlbU5vZGVOYW1lKTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGRlcHRoID0gJChpdGVtc1tpXSkucGFyZW50cyh0aGlzLm9wdGlvbnMubGlzdE5vZGVOYW1lKS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKGRlcHRoID4gdGhpcy5kcmFnRGVwdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmFnRGVwdGggPSBkZXB0aDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy9DcmVhdGUgc3VibGV2ZWwuXG4gICAgICAgIC8vICBlbGVtZW50IDogZWxlbWVudCB3aGljaCBiZWNvbWUgcGFyZW50XG4gICAgICAgIC8vICBpdGVtICAgIDogc29tZXRoaW5nIHRvIHBsYWNlIGludG8gbmV3IHN1YmxldmVsXG4gICAgICAgIGNyZWF0ZVN1YkxldmVsOiBmdW5jdGlvbihlbGVtZW50LCBpdGVtKSB7XG4gICAgICAgICAgICB2YXIgbGlzdCA9ICQoJzwnICsgdGhpcy5vcHRpb25zLmxpc3ROb2RlTmFtZSArICcvPicpLmFkZENsYXNzKHRoaXMub3B0aW9ucy5saXN0Q2xhc3MpO1xuICAgICAgICAgICAgaWYgKGl0ZW0pIGxpc3QuYXBwZW5kKGl0ZW0pO1xuICAgICAgICAgICAgZWxlbWVudC5hcHBlbmQobGlzdCk7XG4gICAgICAgICAgICB0aGlzLnNldFBhcmVudChlbGVtZW50KTtcbiAgICAgICAgICAgIHJldHVybiBsaXN0O1xuICAgICAgICB9LFxuXG4gICAgICAgIHNldEluZGV4T2ZJdGVtOiBmdW5jdGlvbihpdGVtLCBpbmRleCkge1xuICAgICAgICAgICAgaW5kZXggPSBpbmRleCB8fCBbXTtcblxuICAgICAgICAgICAgaW5kZXgudW5zaGlmdChpdGVtLmluZGV4KCkpO1xuXG4gICAgICAgICAgICBpZiAoJChpdGVtWzBdLnBhcmVudE5vZGUpWzBdICE9PSB0aGlzLmRyYWdSb290RWxbMF0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldEluZGV4T2ZJdGVtKCQoaXRlbVswXS5wYXJlbnROb2RlKSwgaW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnRWwuZGF0YSgnaW5kZXhPZkl0ZW0nLCBpbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgcmVzdG9yZUl0ZW1BdEluZGV4OiBmdW5jdGlvbihkcmFnRWxlbWVudCwgaW5kZXhBcnJheSkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRFbCA9IHRoaXMuZWwsXG4gICAgICAgICAgICAgICAgbGFzdEluZGV4ID0gaW5kZXhBcnJheS5sZW5ndGggLSAxO1xuXG4gICAgICAgICAgICAvL1B1dCBkcmFnIGVsZW1lbnQgYXQgY3VycmVudCBlbGVtZW50IHBvc2l0aW9uLlxuICAgICAgICAgICAgZnVuY3Rpb24gcGxhY2VFbGVtZW50KGN1cnJlbnRFbCwgZHJhZ0VsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXhBcnJheVtsYXN0SW5kZXhdID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICQoY3VycmVudEVsKS5wcmVwZW5kKGRyYWdFbGVtZW50LmNsb25lKHRydWUpKTsgLy91c2luZyB0cnVlIHNhdmVzIGFkZGVkIHRvIGVsZW1lbnQgZXZlbnRzLlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJChjdXJyZW50RWwuY2hpbGRyZW5baW5kZXhBcnJheVtsYXN0SW5kZXhdIC0gMV0pLmFmdGVyKGRyYWdFbGVtZW50LmNsb25lKHRydWUpKTsgLy91c2luZyB0cnVlIHNhdmVzIGFkZGVkIHRvIGVsZW1lbnQgZXZlbnRzLlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vRGlnZ2luIHRocm91Z2ggaW5kZXhBcnJheSB0byBnZXQgaG9tZSBmb3IgZHJhZ0VsZW1lbnQuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluZGV4QXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAobGFzdEluZGV4ID09PSBwYXJzZUludChpKSkge1xuICAgICAgICAgICAgICAgICAgICBwbGFjZUVsZW1lbnQoY3VycmVudEVsLCBkcmFnRWxlbWVudCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy9lbGVtZW50IGNhbiBoYXZlIG5vIGluZGV4ZXMsIHNvIHdlIGhhdmUgdG8gdXNlIGNvbmRpdGlvbmFsIGhlcmUgdG8gYXZvaWQgZXJyb3JzLlxuICAgICAgICAgICAgICAgIC8vaWYgZWxlbWVudCBkb2Vzbid0IGV4aXN0IHdlIGRlZmVuZXRseSBuZWVkIHRvIGFkZCBuZXcgbGlzdC5cbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudCA9IChjdXJyZW50RWxbMF0pID8gY3VycmVudEVsWzBdIDogY3VycmVudEVsO1xuICAgICAgICAgICAgICAgIHZhciBuZXh0RWwgID0gZWxlbWVudC5jaGlsZHJlbltpbmRleEFycmF5W2ldXTtcbiAgICAgICAgICAgICAgICBjdXJyZW50RWwgICA9ICghbmV4dEVsKSA/IHRoaXMuY3JlYXRlU3ViTGV2ZWwoJChlbGVtZW50KSkgOiBuZXh0RWw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJhZ1N0b3A6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIC8vIGZpeCBmb3IgemVwdG8uanNcbiAgICAgICAgICAgIC8vdGhpcy5wbGFjZUVsLnJlcGxhY2VXaXRoKHRoaXMuZHJhZ0VsLmNoaWxkcmVuKHRoaXMub3B0aW9ucy5pdGVtTm9kZU5hbWUgKyAnOmZpcnN0JykuZGV0YWNoKCkpO1xuICAgICAgICAgICAgdmFyIHBvc2l0aW9uID0ge1xuICAgICAgICAgICAgICAgIHRvcCAgOiBlLnBhZ2VZLFxuICAgICAgICAgICAgICAgIGxlZnQgOiBlLnBhZ2VYXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgLy9HZXQgaW5kZXhBcnJheSBvZiBpdGVtIGF0IGRyYWcgc3RhcnQuXG4gICAgICAgICAgICB2YXIgc3JjSW5kZXggPSB0aGlzLmRyYWdFbC5kYXRhKCdpbmRleE9mSXRlbScpO1xuXG4gICAgICAgICAgICB2YXIgZWwgPSB0aGlzLmRyYWdFbC5jaGlsZHJlbih0aGlzLm9wdGlvbnMuaXRlbU5vZGVOYW1lKS5maXJzdCgpO1xuXG4gICAgICAgICAgICBlbFswXS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGVsWzBdKTtcblxuICAgICAgICAgICAgdGhpcy5kcmFnRWwucmVtb3ZlKCk7IC8vUmVtb3ZlIGRyYWdFbCwgY2F1c2UgaXQgY2FuIGFmZmVjdCBvbiBpbmRleGluZyBpbiBodG1sIGNvbGxlY3Rpb24uXG5cbiAgICAgICAgICAgIC8vQmVmb3JlIGRyYWcgc3RvcCBjYWxsYmFja1xuICAgICAgICAgICAgdmFyIGNvbnRpbnVlRXhlY3V0aW9uID0gdGhpcy5vcHRpb25zLmJlZm9yZURyYWdTdG9wLmNhbGwodGhpcywgdGhpcy5lbCwgZWwsIHRoaXMucGxhY2VFbC5wYXJlbnQoKSk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNvbnRpbnVlRXhlY3V0aW9uICE9PSAndW5kZWZpbmVkJyAmJiBjb250aW51ZUV4ZWN1dGlvbiA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5wbGFjZUVsLnBhcmVudCgpO1xuICAgICAgICAgICAgICAgIHRoaXMucGxhY2VFbC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICBpZiAoIXBhcmVudC5jaGlsZHJlbigpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc2V0UGFyZW50KHBhcmVudC5wYXJlbnQoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMucmVzdG9yZUl0ZW1BdEluZGV4KGVsLCBzcmNJbmRleCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5wbGFjZUVsLnJlcGxhY2VXaXRoKGVsKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuaGFzTmV3Um9vdCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZml4ZWQgPT09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXN0b3JlSXRlbUF0SW5kZXgoZWwsIHNyY0luZGV4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZWwudHJpZ2dlcignbG9zdEl0ZW0nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnUm9vdEVsLnRyaWdnZXIoJ2dhaW5lZEl0ZW0nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ1Jvb3RFbC50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmNhbGxiYWNrLmNhbGwodGhpcywgdGhpcy5kcmFnUm9vdEVsLCBlbCwgcG9zaXRpb24pO1xuXG4gICAgICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJhZ01vdmU6IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIHZhciBsaXN0LCBwYXJlbnQsIHByZXYsIG5leHQsIGRlcHRoLFxuICAgICAgICAgICAgICAgIG9wdCA9IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICAgICAgICBtb3VzZSA9IHRoaXMubW91c2U7XG5cbiAgICAgICAgICAgIHRoaXMuZHJhZ0VsLmNzcyh7XG4gICAgICAgICAgICAgICAgJ2xlZnQnOiBlLnBhZ2VYIC0gbW91c2Uub2Zmc2V0WCxcbiAgICAgICAgICAgICAgICAndG9wJzogZS5wYWdlWSAtIG1vdXNlLm9mZnNldFlcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBtb3VzZSBwb3NpdGlvbiBsYXN0IGV2ZW50c1xuICAgICAgICAgICAgbW91c2UubGFzdFggPSBtb3VzZS5ub3dYO1xuICAgICAgICAgICAgbW91c2UubGFzdFkgPSBtb3VzZS5ub3dZO1xuICAgICAgICAgICAgLy8gbW91c2UgcG9zaXRpb24gdGhpcyBldmVudHNcbiAgICAgICAgICAgIG1vdXNlLm5vd1ggPSBlLnBhZ2VYO1xuICAgICAgICAgICAgbW91c2Uubm93WSA9IGUucGFnZVk7XG4gICAgICAgICAgICAvLyBkaXN0YW5jZSBtb3VzZSBtb3ZlZCBiZXR3ZWVuIGV2ZW50c1xuICAgICAgICAgICAgbW91c2UuZGlzdFggPSBtb3VzZS5ub3dYIC0gbW91c2UubGFzdFg7XG4gICAgICAgICAgICBtb3VzZS5kaXN0WSA9IG1vdXNlLm5vd1kgLSBtb3VzZS5sYXN0WTtcbiAgICAgICAgICAgIC8vIGRpcmVjdGlvbiBtb3VzZSB3YXMgbW92aW5nXG4gICAgICAgICAgICBtb3VzZS5sYXN0RGlyWCA9IG1vdXNlLmRpclg7XG4gICAgICAgICAgICBtb3VzZS5sYXN0RGlyWSA9IG1vdXNlLmRpclk7XG4gICAgICAgICAgICAvLyBkaXJlY3Rpb24gbW91c2UgaXMgbm93IG1vdmluZyAob24gYm90aCBheGlzKVxuICAgICAgICAgICAgbW91c2UuZGlyWCA9IG1vdXNlLmRpc3RYID09PSAwID8gMCA6IG1vdXNlLmRpc3RYID4gMCA/IDEgOiAtMTtcbiAgICAgICAgICAgIG1vdXNlLmRpclkgPSBtb3VzZS5kaXN0WSA9PT0gMCA/IDAgOiBtb3VzZS5kaXN0WSA+IDAgPyAxIDogLTE7XG4gICAgICAgICAgICAvLyBheGlzIG1vdXNlIGlzIG5vdyBtb3Zpbmcgb25cbiAgICAgICAgICAgIHZhciBuZXdBeCA9IE1hdGguYWJzKG1vdXNlLmRpc3RYKSA+IE1hdGguYWJzKG1vdXNlLmRpc3RZKSA/IDEgOiAwO1xuXG4gICAgICAgICAgICAvLyBkbyBub3RoaW5nIG9uIGZpcnN0IG1vdmVcbiAgICAgICAgICAgIGlmICghbW91c2UubW92aW5nKSB7XG4gICAgICAgICAgICAgICAgbW91c2UuZGlyQXggPSBuZXdBeDtcbiAgICAgICAgICAgICAgICBtb3VzZS5tb3ZpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZG8gc2Nyb2xsaW5nIGlmIGVuYWJsZVxuICAgICAgICAgICAgaWYgKG9wdC5zY3JvbGwpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdy5qUXVlcnkuZm4uc2Nyb2xsUGFyZW50ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2Nyb2xsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjcm9sbFBhcmVudCA9IHRoaXMuZWwuc2Nyb2xsUGFyZW50KClbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY3JvbGxQYXJlbnQgIT09IGRvY3VtZW50ICYmIHNjcm9sbFBhcmVudC50YWdOYW1lICE9PSAnSFRNTCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgob3B0LnNjcm9sbFRyaWdnZXJzLmJvdHRvbSArIHNjcm9sbFBhcmVudC5vZmZzZXRIZWlnaHQpIC0gZS5wYWdlWSA8IG9wdC5zY3JvbGxTZW5zaXRpdml0eSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxQYXJlbnQuc2Nyb2xsVG9wID0gc2Nyb2xsZWQgPSBzY3JvbGxQYXJlbnQuc2Nyb2xsVG9wICsgb3B0LnNjcm9sbFNwZWVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZS5wYWdlWSAtIG9wdC5zY3JvbGxUcmlnZ2Vycy50b3AgPCBvcHQuc2Nyb2xsU2Vuc2l0aXZpdHkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCA9IHNjcm9sbGVkID0gc2Nyb2xsUGFyZW50LnNjcm9sbFRvcCAtIG9wdC5zY3JvbGxTcGVlZDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChvcHQuc2Nyb2xsVHJpZ2dlcnMucmlnaHQgKyBzY3JvbGxQYXJlbnQub2Zmc2V0V2lkdGgpIC0gZS5wYWdlWCA8IG9wdC5zY3JvbGxTZW5zaXRpdml0eSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxQYXJlbnQuc2Nyb2xsTGVmdCA9IHNjcm9sbGVkID0gc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQgKyBvcHQuc2Nyb2xsU3BlZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlLnBhZ2VYIC0gb3B0LnNjcm9sbFRyaWdnZXJzLmxlZnQgPCBvcHQuc2Nyb2xsU2Vuc2l0aXZpdHkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsUGFyZW50LnNjcm9sbExlZnQgPSBzY3JvbGxlZCA9IHNjcm9sbFBhcmVudC5zY3JvbGxMZWZ0IC0gb3B0LnNjcm9sbFNwZWVkO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUucGFnZVkgLSAkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSA8IG9wdC5zY3JvbGxTZW5zaXRpdml0eSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSAtIG9wdC5zY3JvbGxTcGVlZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICgkKHdpbmRvdykuaGVpZ2h0KCkgLSAoZS5wYWdlWSAtICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpKSA8IG9wdC5zY3JvbGxTZW5zaXRpdml0eSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxlZCA9ICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSArIG9wdC5zY3JvbGxTcGVlZCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlLnBhZ2VYIC0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgpIDwgb3B0LnNjcm9sbFNlbnNpdGl2aXR5KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbGVkID0gJChkb2N1bWVudCkuc2Nyb2xsTGVmdCgkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCkgLSBvcHQuc2Nyb2xsU3BlZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoJCh3aW5kb3cpLndpZHRoKCkgLSAoZS5wYWdlWCAtICQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSkgPCBvcHQuc2Nyb2xsU2Vuc2l0aXZpdHkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsZWQgPSAkKGRvY3VtZW50KS5zY3JvbGxMZWZ0KCQoZG9jdW1lbnQpLnNjcm9sbExlZnQoKSArIG9wdC5zY3JvbGxTcGVlZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ1RvIHVzZSBzY3JvbGxpbmcgeW91IG5lZWQgdG8gaGF2ZSBzY3JvbGxQYXJlbnQoKSBmdW5jdGlvbiwgY2hlY2sgZG9jdW1lbnRhdGlvbiBmb3IgbW9yZSBpbmZvcm1hdGlvbicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuc2Nyb2xsVGltZXIpIHtcbiAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5zY3JvbGxUaW1lcik7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChvcHQuc2Nyb2xsICYmIHNjcm9sbGVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICQod2luZG93KS50cmlnZ2VyKGUpO1xuICAgICAgICAgICAgICAgIH0sIDEwKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSBtb3ZlZCBvbiB0aGlzIGF4aXMgKGFuZCBkaXJlY3Rpb24pXG4gICAgICAgICAgICBpZiAobW91c2UuZGlyQXggIT09IG5ld0F4KSB7XG4gICAgICAgICAgICAgICAgbW91c2UuZGlzdEF4WCA9IDA7XG4gICAgICAgICAgICAgICAgbW91c2UuZGlzdEF4WSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhYICs9IE1hdGguYWJzKG1vdXNlLmRpc3RYKTtcbiAgICAgICAgICAgICAgICBpZiAobW91c2UuZGlyWCAhPT0gMCAmJiBtb3VzZS5kaXJYICE9PSBtb3VzZS5sYXN0RGlyWCkge1xuICAgICAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhYID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbW91c2UuZGlzdEF4WSArPSBNYXRoLmFicyhtb3VzZS5kaXN0WSk7XG4gICAgICAgICAgICAgICAgaWYgKG1vdXNlLmRpclkgIT09IDAgJiYgbW91c2UuZGlyWSAhPT0gbW91c2UubGFzdERpclkpIHtcbiAgICAgICAgICAgICAgICAgICAgbW91c2UuZGlzdEF4WSA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbW91c2UuZGlyQXggPSBuZXdBeDtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBtb3ZlIGhvcml6b250YWxcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYgKG1vdXNlLmRpckF4ICYmIG1vdXNlLmRpc3RBeFggPj0gb3B0LnRocmVzaG9sZCkge1xuICAgICAgICAgICAgICAgIC8vIHJlc2V0IG1vdmUgZGlzdGFuY2Ugb24geC1heGlzIGZvciBuZXcgcGhhc2VcbiAgICAgICAgICAgICAgICBtb3VzZS5kaXN0QXhYID0gMDtcbiAgICAgICAgICAgICAgICBwcmV2ID0gdGhpcy5wbGFjZUVsLnByZXYob3B0Lml0ZW1Ob2RlTmFtZSk7XG4gICAgICAgICAgICAgICAgLy8gaW5jcmVhc2UgaG9yaXpvbnRhbCBsZXZlbCBpZiBwcmV2aW91cyBzaWJsaW5nIGV4aXN0cywgaXMgbm90IGNvbGxhcHNlZCwgYW5kIGNhbiBoYXZlIGNoaWxkcmVuXG4gICAgICAgICAgICAgICAgaWYgKG1vdXNlLmRpc3RYID4gMCAmJiBwcmV2Lmxlbmd0aCAmJiAhcHJldi5oYXNDbGFzcyhvcHQuY29sbGFwc2VkQ2xhc3MpICYmICFwcmV2Lmhhc0NsYXNzKG9wdC5ub0NoaWxkcmVuQ2xhc3MpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNhbm5vdCBpbmNyZWFzZSBsZXZlbCB3aGVuIGl0ZW0gYWJvdmUgaXMgY29sbGFwc2VkXG4gICAgICAgICAgICAgICAgICAgIGxpc3QgPSBwcmV2LmZpbmQob3B0Lmxpc3ROb2RlTmFtZSkubGFzdCgpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBpZiBkZXB0aCBsaW1pdCBoYXMgcmVhY2hlZFxuICAgICAgICAgICAgICAgICAgICBkZXB0aCA9IHRoaXMucGxhY2VFbC5wYXJlbnRzKG9wdC5saXN0Tm9kZU5hbWUpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGRlcHRoICsgdGhpcy5kcmFnRGVwdGggPD0gb3B0Lm1heERlcHRoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgbmV3IHN1Yi1sZXZlbCBpZiBvbmUgZG9lc24ndCBleGlzdFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFsaXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlU3ViTGV2ZWwocHJldiwgdGhpcy5wbGFjZUVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVsc2UgYXBwZW5kIHRvIG5leHQgbGV2ZWwgdXBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0ID0gcHJldi5jaGlsZHJlbihvcHQubGlzdE5vZGVOYW1lKS5sYXN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdC5hcHBlbmQodGhpcy5wbGFjZUVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBkZWNyZWFzZSBob3Jpem9udGFsIGxldmVsXG4gICAgICAgICAgICAgICAgaWYgKG1vdXNlLmRpc3RYIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAvLyB3ZSBjYW4ndCBkZWNyZWFzZSBhIGxldmVsIGlmIGFuIGl0ZW0gcHJlY2VlZHMgdGhlIGN1cnJlbnQgb25lXG4gICAgICAgICAgICAgICAgICAgIG5leHQgPSB0aGlzLnBsYWNlRWwubmV4dChvcHQuaXRlbU5vZGVOYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50ID0gdGhpcy5wbGFjZUVsLnBhcmVudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wbGFjZUVsLmNsb3Nlc3Qob3B0Lml0ZW1Ob2RlTmFtZSkuYWZ0ZXIodGhpcy5wbGFjZUVsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGFyZW50LmNoaWxkcmVuKCkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy51bnNldFBhcmVudChwYXJlbnQucGFyZW50KCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgaXNFbXB0eSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAvLyBmaW5kIGxpc3QgaXRlbSB1bmRlciBjdXJzb3JcbiAgICAgICAgICAgIGlmICghaGFzUG9pbnRlckV2ZW50cykge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhZ0VsWzBdLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucG9pbnRFbCA9ICQoZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludChlLnBhZ2VYIC0gZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0LCBlLnBhZ2VZIC0gKHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wKSkpO1xuICAgICAgICAgICAgaWYgKCFoYXNQb2ludGVyRXZlbnRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmFnRWxbMF0uc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnBvaW50RWwuaGFzQ2xhc3Mob3B0LmhhbmRsZUNsYXNzKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucG9pbnRFbCA9IHRoaXMucG9pbnRFbC5jbG9zZXN0KG9wdC5pdGVtTm9kZU5hbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMucG9pbnRFbC5oYXNDbGFzcyhvcHQuZW1wdHlDbGFzcykpIHtcbiAgICAgICAgICAgICAgICBpc0VtcHR5ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCF0aGlzLnBvaW50RWwubGVuZ3RoIHx8ICF0aGlzLnBvaW50RWwuaGFzQ2xhc3Mob3B0Lml0ZW1DbGFzcykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGZpbmQgcGFyZW50IGxpc3Qgb2YgaXRlbSB1bmRlciBjdXJzb3JcbiAgICAgICAgICAgIHZhciBwb2ludEVsUm9vdCA9IHRoaXMucG9pbnRFbC5jbG9zZXN0KCcuJyArIG9wdC5yb290Q2xhc3MpLFxuICAgICAgICAgICAgICAgIGlzTmV3Um9vdCA9IHRoaXMuZHJhZ1Jvb3RFbC5kYXRhKCduZXN0YWJsZS1pZCcpICE9PSBwb2ludEVsUm9vdC5kYXRhKCduZXN0YWJsZS1pZCcpO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIG1vdmUgdmVydGljYWxcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgaWYgKCFtb3VzZS5kaXJBeCB8fCBpc05ld1Jvb3QgfHwgaXNFbXB0eSkge1xuICAgICAgICAgICAgICAgIC8vIGNoZWNrIGlmIGdyb3VwcyBtYXRjaCBpZiBkcmFnZ2luZyBvdmVyIG5ldyByb290XG4gICAgICAgICAgICAgICAgaWYgKGlzTmV3Um9vdCAmJiBvcHQuZ3JvdXAgIT09IHBvaW50RWxSb290LmRhdGEoJ25lc3RhYmxlLWdyb3VwJykpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIGZpeGVkIGl0ZW0ncyBkZXB0aCwgdXNlIGZvciBzb21lIGxpc3QgaGFzIHNwZWNpZmljIHR5cGUsIGVnOidWb2x1bWUsIFNlY3Rpb24sIENoYXB0ZXIgLi4uJ1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZml4ZWREZXB0aCAmJiB0aGlzLmRyYWdEZXB0aCArIDEgIT09IHRoaXMucG9pbnRFbC5wYXJlbnRzKG9wdC5saXN0Tm9kZU5hbWUpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgZGVwdGggbGltaXRcbiAgICAgICAgICAgICAgICBkZXB0aCA9IHRoaXMuZHJhZ0RlcHRoIC0gMSArIHRoaXMucG9pbnRFbC5wYXJlbnRzKG9wdC5saXN0Tm9kZU5hbWUpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAoZGVwdGggPiBvcHQubWF4RGVwdGgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgYmVmb3JlID0gZS5wYWdlWSA8ICh0aGlzLnBvaW50RWwub2Zmc2V0KCkudG9wICsgdGhpcy5wb2ludEVsLmhlaWdodCgpIC8gMik7XG4gICAgICAgICAgICAgICAgcGFyZW50ID0gdGhpcy5wbGFjZUVsLnBhcmVudCgpO1xuICAgICAgICAgICAgICAgIC8vIGlmIGVtcHR5IGNyZWF0ZSBuZXcgbGlzdCB0byByZXBsYWNlIGVtcHR5IHBsYWNlaG9sZGVyXG4gICAgICAgICAgICAgICAgaWYgKGlzRW1wdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdCA9ICQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChvcHQubGlzdE5vZGVOYW1lKSkuYWRkQ2xhc3Mob3B0Lmxpc3RDbGFzcyk7XG4gICAgICAgICAgICAgICAgICAgIGxpc3QuYXBwZW5kKHRoaXMucGxhY2VFbCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9pbnRFbC5yZXBsYWNlV2l0aChsaXN0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYmVmb3JlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9pbnRFbC5iZWZvcmUodGhpcy5wbGFjZUVsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucG9pbnRFbC5hZnRlcih0aGlzLnBsYWNlRWwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXBhcmVudC5jaGlsZHJlbigpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnVuc2V0UGFyZW50KHBhcmVudC5wYXJlbnQoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5kcmFnUm9vdEVsLmZpbmQob3B0Lml0ZW1Ob2RlTmFtZSkubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYXBwZW5kRW1wdHlFbGVtZW50KHRoaXMuZHJhZ1Jvb3RFbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIHBhcmVudCByb290IGxpc3QgaGFzIGNoYW5nZWRcbiAgICAgICAgICAgICAgICB0aGlzLmRyYWdSb290RWwgPSBwb2ludEVsUm9vdDtcbiAgICAgICAgICAgICAgICBpZiAoaXNOZXdSb290KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaGFzTmV3Um9vdCA9IHRoaXMuZWxbMF0gIT09IHRoaXMuZHJhZ1Jvb3RFbFswXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gQXBwZW5kIHRoZSAuZGQtZW1wdHkgZGl2IHRvIHRoZSBsaXN0IHNvIGl0IGNhbiBiZSBwb3B1bGF0ZWQgYW5kIHN0eWxlZFxuICAgICAgICBhcHBlbmRFbXB0eUVsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKCc8ZGl2IGNsYXNzPVwiJyArIHRoaXMub3B0aW9ucy5lbXB0eUNsYXNzICsgJ1wiLz4nKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAkLmZuLm5lc3RhYmxlID0gZnVuY3Rpb24ocGFyYW1zKSB7XG4gICAgICAgIHZhciBsaXN0cyAgPSB0aGlzLFxuICAgICAgICAgICAgcmV0dmFsID0gdGhpcyxcbiAgICAgICAgICAgIGFyZ3MgICA9IGFyZ3VtZW50cztcblxuICAgICAgICBpZiAoISgnTmVzdGFibGUnIGluIHdpbmRvdykpIHtcbiAgICAgICAgICAgIHdpbmRvdy5OZXN0YWJsZSA9IHt9O1xuICAgICAgICAgICAgTmVzdGFibGUuY291bnRlciA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICBsaXN0cy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIHBsdWdpbiA9ICQodGhpcykuZGF0YShcIm5lc3RhYmxlXCIpO1xuXG4gICAgICAgICAgICBpZiAoIXBsdWdpbikge1xuICAgICAgICAgICAgICAgIE5lc3RhYmxlLmNvdW50ZXIrKztcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmRhdGEoXCJuZXN0YWJsZVwiLCBuZXcgUGx1Z2luKHRoaXMsIHBhcmFtcykpO1xuICAgICAgICAgICAgICAgICQodGhpcykuZGF0YShcIm5lc3RhYmxlLWlkXCIsIE5lc3RhYmxlLmNvdW50ZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXJhbXMgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBwbHVnaW5bcGFyYW1zXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAxKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwbHVnaW5BcmdzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwbHVnaW5BcmdzLnB1c2goYXJnc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR2YWwgPSBwbHVnaW5bcGFyYW1zXS5hcHBseShwbHVnaW4sIHBsdWdpbkFyZ3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dmFsID0gcGx1Z2luW3BhcmFtc10oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHJldHZhbCB8fCBsaXN0cztcbiAgICB9O1xuXG59KSh3aW5kb3cualF1ZXJ5IHx8IHdpbmRvdy5aZXB0bywgd2luZG93LCBkb2N1bWVudCk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./Modules/Menu/node_modules/nestable2/jquery.nestable.js\n");

/***/ }),

/***/ "./Modules/Menu/Resources/assets/admin/js/main.js":
/*!********************************************************!*\
  !*** ./Modules/Menu/Resources/assets/admin/js/main.js ***!
  \********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var nestable2__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! nestable2 */ \"./Modules/Menu/node_modules/nestable2/jquery.nestable.js\");\n/* harmony import */ var nestable2__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(nestable2__WEBPACK_IMPORTED_MODULE_0__);\n\nwindow.admin.removeSubmitButtonOffsetOn('#image');\n$('#type').on('change', function (e) {\n  $('.link-field').addClass('hide');\n  $(\".\".concat(e.currentTarget.value, \"-field\")).removeClass('hide');\n});\n$('.dd').nestable({\n  maxDepth: 15\n});\n$('.dd').on('change', function () {\n  $.ajax({\n    type: 'PUT',\n    url: route('admin.menus.items.order.update'),\n    contentType: 'application/json; charset=utf-8',\n    data: JSON.stringify($('.dd').nestable('serialize')[0]),\n    success: function (_success) {\n      function success() {\n        return _success.apply(this, arguments);\n      }\n      success.toString = function () {\n        return _success.toString();\n      };\n      return success;\n    }(function () {\n      success(trans('menu::messages.menu_items_order_updated'));\n    }),\n    error: function (_error) {\n      function error(_x) {\n        return _error.apply(this, arguments);\n      }\n      error.toString = function () {\n        return _error.toString();\n      };\n      return error;\n    }(function (xhr) {\n      error(xhr.responseJSON.message);\n    })\n  });\n});\nvar id;\nvar confirmationModal = $('#confirmation-modal');\n$('.delete-menu-item').on('click', function (e) {\n  id = $(e.currentTarget).closest('.dd-item').data('id');\n  confirmationModal.modal('show');\n});\nconfirmationModal.find('form').on('submit', function (e) {\n  e.preventDefault();\n  confirmationModal.modal('hide');\n  $.ajax({\n    type: 'DELETE',\n    url: route('admin.menus.items.destroy', id),\n    success: function (_success2) {\n      function success() {\n        return _success2.apply(this, arguments);\n      }\n      success.toString = function () {\n        return _success2.toString();\n      };\n      return success;\n    }(function () {\n      success(trans('menu::messages.menu_item_deleted'));\n      $(\".dd-item[data-id=\\\"\".concat(id, \"\\\"]\")).fadeOut();\n    }),\n    error: function (_error2) {\n      function error(_x2) {\n        return _error2.apply(this, arguments);\n      }\n      error.toString = function () {\n        return _error2.toString();\n      };\n      return error;\n    }(function (xhr) {\n      error(xhr.responseJSON.message);\n    })\n  });\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9Nb2R1bGVzL01lbnUvUmVzb3VyY2VzL2Fzc2V0cy9hZG1pbi9qcy9tYWluLmpzLmpzIiwibWFwcGluZ3MiOiI7OztBQUFtQjtBQUVuQkEsTUFBTSxDQUFDQyxLQUFLLENBQUNDLDBCQUEwQixDQUFDLFFBQVEsQ0FBQztBQUVqREMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDQyxFQUFFLENBQUMsUUFBUSxFQUFFLFVBQUNDLENBQUMsRUFBSztFQUMzQkYsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDRyxRQUFRLENBQUMsTUFBTSxDQUFDO0VBQ2pDSCxDQUFDLEtBQUFJLE1BQUEsQ0FBS0YsQ0FBQyxDQUFDRyxhQUFhLENBQUNDLEtBQUssWUFBUyxDQUFDQyxXQUFXLENBQUMsTUFBTSxDQUFDO0FBQzVELENBQUMsQ0FBQztBQUVGUCxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUNRLFFBQVEsQ0FBQztFQUFFQyxRQUFRLEVBQUU7QUFBRyxDQUFDLENBQUM7QUFFbkNULENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQ0MsRUFBRSxDQUFDLFFBQVEsRUFBRSxZQUFNO0VBQ3hCRCxDQUFDLENBQUNVLElBQUksQ0FBQztJQUNIQyxJQUFJLEVBQUUsS0FBSztJQUNYQyxHQUFHLEVBQUVDLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FBQztJQUM1Q0MsV0FBVyxFQUFFLGlDQUFpQztJQUM5Q0MsSUFBSSxFQUFFQyxJQUFJLENBQUNDLFNBQVMsQ0FBQ2pCLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQ1EsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZEVSxPQUFPLFlBQUFDLFFBQUE7TUFBQSxTQUFBRCxRQUFBO1FBQUEsT0FBQUMsUUFBQSxDQUFBQyxLQUFBLE9BQUFDLFNBQUE7TUFBQTtNQUFBSCxPQUFBLENBQUFJLFFBQUE7UUFBQSxPQUFBSCxRQUFBLENBQUFHLFFBQUE7TUFBQTtNQUFBLE9BQUFKLE9BQUE7SUFBQSxjQUFHO01BQ05BLE9BQU8sQ0FBQ0ssS0FBSyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUNEQyxLQUFLLFlBQUFDLE1BQUE7TUFBQSxTQUFBRCxNQUFBRSxFQUFBO1FBQUEsT0FBQUQsTUFBQSxDQUFBTCxLQUFBLE9BQUFDLFNBQUE7TUFBQTtNQUFBRyxLQUFBLENBQUFGLFFBQUE7UUFBQSxPQUFBRyxNQUFBLENBQUFILFFBQUE7TUFBQTtNQUFBLE9BQUFFLEtBQUE7SUFBQSxZQUFDRyxHQUFHLEVBQUU7TUFDUEgsS0FBSyxDQUFDRyxHQUFHLENBQUNDLFlBQVksQ0FBQ0MsT0FBTyxDQUFDO0lBQ25DLENBQUM7RUFDTCxDQUFDLENBQUM7QUFDTixDQUFDLENBQUM7QUFFRixJQUFJQyxFQUFFO0FBQ04sSUFBSUMsaUJBQWlCLEdBQUcvQixDQUFDLENBQUMscUJBQXFCLENBQUM7QUFFaERBLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDQyxFQUFFLENBQUMsT0FBTyxFQUFFLFVBQUNDLENBQUMsRUFBSztFQUN0QzRCLEVBQUUsR0FBRzlCLENBQUMsQ0FBQ0UsQ0FBQyxDQUFDRyxhQUFhLENBQUMsQ0FBQzJCLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQ2pCLElBQUksQ0FBQyxJQUFJLENBQUM7RUFFdERnQixpQkFBaUIsQ0FBQ0UsS0FBSyxDQUFDLE1BQU0sQ0FBQztBQUNuQyxDQUFDLENBQUM7QUFFRkYsaUJBQWlCLENBQUNHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQ2pDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsVUFBQ0MsQ0FBQyxFQUFLO0VBQy9DQSxDQUFDLENBQUNpQyxjQUFjLEVBQUU7RUFFbEJKLGlCQUFpQixDQUFDRSxLQUFLLENBQUMsTUFBTSxDQUFDO0VBRS9CakMsQ0FBQyxDQUFDVSxJQUFJLENBQUM7SUFDSEMsSUFBSSxFQUFFLFFBQVE7SUFDZEMsR0FBRyxFQUFFQyxLQUFLLENBQUMsMkJBQTJCLEVBQUVpQixFQUFFLENBQUM7SUFDM0NaLE9BQU8sWUFBQWtCLFNBQUE7TUFBQSxTQUFBbEIsUUFBQTtRQUFBLE9BQUFrQixTQUFBLENBQUFoQixLQUFBLE9BQUFDLFNBQUE7TUFBQTtNQUFBSCxPQUFBLENBQUFJLFFBQUE7UUFBQSxPQUFBYyxTQUFBLENBQUFkLFFBQUE7TUFBQTtNQUFBLE9BQUFKLE9BQUE7SUFBQSxjQUFHO01BQ05BLE9BQU8sQ0FBQ0ssS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7TUFFbER2QixDQUFDLHVCQUFBSSxNQUFBLENBQXNCMEIsRUFBRSxTQUFLLENBQUNPLE9BQU8sRUFBRTtJQUM1QyxDQUFDO0lBQ0RiLEtBQUssWUFBQWMsT0FBQTtNQUFBLFNBQUFkLE1BQUFlLEdBQUE7UUFBQSxPQUFBRCxPQUFBLENBQUFsQixLQUFBLE9BQUFDLFNBQUE7TUFBQTtNQUFBRyxLQUFBLENBQUFGLFFBQUE7UUFBQSxPQUFBZ0IsT0FBQSxDQUFBaEIsUUFBQTtNQUFBO01BQUEsT0FBQUUsS0FBQTtJQUFBLFlBQUNHLEdBQUcsRUFBRTtNQUNQSCxLQUFLLENBQUNHLEdBQUcsQ0FBQ0MsWUFBWSxDQUFDQyxPQUFPLENBQUM7SUFDbkMsQ0FBQztFQUNMLENBQUMsQ0FBQztBQUNOLENBQUMsQ0FBQyIsInNvdXJjZXMiOlsid2VicGFjazovL2ZsZWV0Y2FydC8uL01vZHVsZXMvTWVudS9SZXNvdXJjZXMvYXNzZXRzL2FkbWluL2pzL21haW4uanM/NTc0MSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ25lc3RhYmxlMic7XHJcblxyXG53aW5kb3cuYWRtaW4ucmVtb3ZlU3VibWl0QnV0dG9uT2Zmc2V0T24oJyNpbWFnZScpO1xyXG5cclxuJCgnI3R5cGUnKS5vbignY2hhbmdlJywgKGUpID0+IHtcclxuICAgICQoJy5saW5rLWZpZWxkJykuYWRkQ2xhc3MoJ2hpZGUnKTtcclxuICAgICQoYC4ke2UuY3VycmVudFRhcmdldC52YWx1ZX0tZmllbGRgKS5yZW1vdmVDbGFzcygnaGlkZScpO1xyXG59KTtcclxuXHJcbiQoJy5kZCcpLm5lc3RhYmxlKHsgbWF4RGVwdGg6IDE1IH0pO1xyXG5cclxuJCgnLmRkJykub24oJ2NoYW5nZScsICgpID0+IHtcclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdHlwZTogJ1BVVCcsXHJcbiAgICAgICAgdXJsOiByb3V0ZSgnYWRtaW4ubWVudXMuaXRlbXMub3JkZXIudXBkYXRlJyksXHJcbiAgICAgICAgY29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04JyxcclxuICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSgkKCcuZGQnKS5uZXN0YWJsZSgnc2VyaWFsaXplJylbMF0pLFxyXG4gICAgICAgIHN1Y2Nlc3MoKSB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3ModHJhbnMoJ21lbnU6Om1lc3NhZ2VzLm1lbnVfaXRlbXNfb3JkZXJfdXBkYXRlZCcpKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yKHhocikge1xyXG4gICAgICAgICAgICBlcnJvcih4aHIucmVzcG9uc2VKU09OLm1lc3NhZ2UpO1xyXG4gICAgICAgIH0sXHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5sZXQgaWQ7XHJcbmxldCBjb25maXJtYXRpb25Nb2RhbCA9ICQoJyNjb25maXJtYXRpb24tbW9kYWwnKTtcclxuXHJcbiQoJy5kZWxldGUtbWVudS1pdGVtJykub24oJ2NsaWNrJywgKGUpID0+IHtcclxuICAgIGlkID0gJChlLmN1cnJlbnRUYXJnZXQpLmNsb3Nlc3QoJy5kZC1pdGVtJykuZGF0YSgnaWQnKTtcclxuXHJcbiAgICBjb25maXJtYXRpb25Nb2RhbC5tb2RhbCgnc2hvdycpO1xyXG59KTtcclxuXHJcbmNvbmZpcm1hdGlvbk1vZGFsLmZpbmQoJ2Zvcm0nKS5vbignc3VibWl0JywgKGUpID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBjb25maXJtYXRpb25Nb2RhbC5tb2RhbCgnaGlkZScpO1xyXG5cclxuICAgICQuYWpheCh7XHJcbiAgICAgICAgdHlwZTogJ0RFTEVURScsXHJcbiAgICAgICAgdXJsOiByb3V0ZSgnYWRtaW4ubWVudXMuaXRlbXMuZGVzdHJveScsIGlkKSxcclxuICAgICAgICBzdWNjZXNzKCkge1xyXG4gICAgICAgICAgICBzdWNjZXNzKHRyYW5zKCdtZW51OjptZXNzYWdlcy5tZW51X2l0ZW1fZGVsZXRlZCcpKTtcclxuXHJcbiAgICAgICAgICAgICQoYC5kZC1pdGVtW2RhdGEtaWQ9XCIke2lkfVwiXWApLmZhZGVPdXQoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVycm9yKHhocikge1xyXG4gICAgICAgICAgICBlcnJvcih4aHIucmVzcG9uc2VKU09OLm1lc3NhZ2UpO1xyXG4gICAgICAgIH0sXHJcbiAgICB9KTtcclxufSk7XHJcbiJdLCJuYW1lcyI6WyJ3aW5kb3ciLCJhZG1pbiIsInJlbW92ZVN1Ym1pdEJ1dHRvbk9mZnNldE9uIiwiJCIsIm9uIiwiZSIsImFkZENsYXNzIiwiY29uY2F0IiwiY3VycmVudFRhcmdldCIsInZhbHVlIiwicmVtb3ZlQ2xhc3MiLCJuZXN0YWJsZSIsIm1heERlcHRoIiwiYWpheCIsInR5cGUiLCJ1cmwiLCJyb3V0ZSIsImNvbnRlbnRUeXBlIiwiZGF0YSIsIkpTT04iLCJzdHJpbmdpZnkiLCJzdWNjZXNzIiwiX3N1Y2Nlc3MiLCJhcHBseSIsImFyZ3VtZW50cyIsInRvU3RyaW5nIiwidHJhbnMiLCJlcnJvciIsIl9lcnJvciIsIl94IiwieGhyIiwicmVzcG9uc2VKU09OIiwibWVzc2FnZSIsImlkIiwiY29uZmlybWF0aW9uTW9kYWwiLCJjbG9zZXN0IiwibW9kYWwiLCJmaW5kIiwicHJldmVudERlZmF1bHQiLCJfc3VjY2VzczIiLCJmYWRlT3V0IiwiX2Vycm9yMiIsIl94MiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./Modules/Menu/Resources/assets/admin/js/main.js\n");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./Modules/Menu/Resources/assets/admin/js/main.js");
/******/ 	
/******/ })()
;